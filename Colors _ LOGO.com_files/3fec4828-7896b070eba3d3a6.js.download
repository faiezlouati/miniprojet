"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1362],{6192:function(t,r,n){let s,a,i,o,l,d,c;n.d(r,{U:function(){return Replay}});var u,h,p,g,m,f,_,y,b,I,S=n(16346),C=n(23720),v=n(72751),w=n(57201),E=n(39547),k=n(61260),A=n(15906),R=n(30991),T=n(39528),x=n(38090),M=n(43734),N=n(13798),D=n(33026),O=n(229),B=n(48484),L=n(77345),F=n(37127);let z=k.n2,U="sentryReplaySession",W="Unable to send Replay";function isElement$1(t){return t.nodeType===t.ELEMENT_NODE}function isShadowRoot(t){let r=null==t?void 0:t.host;return(null==r?void 0:r.shadowRoot)===t}function isNativeShadowDom(t){return"[object ShadowRoot]"===Object.prototype.toString.call(t)}function fixBrowserCompatibilityIssuesInCSS(t){return t.includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),t}function escapeImportStatement(t){let{cssText:r}=t;if(r.split('"').length<3)return r;let n=["@import",`url(${JSON.stringify(t.href)})`];return""===t.layerName?n.push("layer"):t.layerName&&n.push(`layer(${t.layerName})`),t.supportsText&&n.push(`supports(${t.supportsText})`),t.media.length&&n.push(t.media.mediaText),n.join(" ")+";"}function stringifyStylesheet(t){try{let r=t.rules||t.cssRules;return r?fixBrowserCompatibilityIssuesInCSS(Array.from(r,stringifyRule).join("")):null}catch(t){return null}}function stringifyRule(t){let r;if(isCSSImportRule(t))try{r=stringifyStylesheet(t.styleSheet)||escapeImportStatement(t)}catch(t){}else if(isCSSStyleRule(t)&&t.selectorText.includes(":"))return fixSafariColons(t.cssText);return r||t.cssText}function fixSafariColons(t){return t.replace(/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm,"$1\\$2")}function isCSSImportRule(t){return"styleSheet"in t}function isCSSStyleRule(t){return"selectorText"in t}(h=b||(b={}))[h.Document=0]="Document",h[h.DocumentType=1]="DocumentType",h[h.Element=2]="Element",h[h.Text=3]="Text",h[h.CDATA=4]="CDATA",h[h.Comment=5]="Comment";let Mirror=class Mirror{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var r;if(!t)return -1;let n=null===(r=this.getMeta(t))||void 0===r?void 0:r.id;return null!=n?n:-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){let r=this.getId(t);this.idNodeMap.delete(r),t.childNodes&&t.childNodes.forEach(t=>this.removeNodeFromMap(t))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,r){let n=r.id;this.idNodeMap.set(n,t),this.nodeMetaMap.set(t,r)}replace(t,r){let n=this.getNode(t);if(n){let t=this.nodeMetaMap.get(n);t&&this.nodeMetaMap.set(r,t)}this.idNodeMap.set(t,r)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}};function createMirror(){return new Mirror}function shouldMaskInput({maskInputOptions:t,tagName:r,type:n}){return"OPTION"===r&&(r="SELECT"),!!(t[r.toLowerCase()]||n&&t[n]||"password"===n||"INPUT"===r&&!n&&t.text)}function maskInputValue({isMasked:t,element:r,value:n,maskInputFn:s}){let a=n||"";return t?(s&&(a=s(a,r)),"*".repeat(a.length)):a}function toLowerCase(t){return t.toLowerCase()}function toUpperCase(t){return t.toUpperCase()}let G="__rrweb_original__";function is2DCanvasBlank(t){let r=t.getContext("2d");if(!r)return!0;for(let n=0;n<t.width;n+=50)for(let s=0;s<t.height;s+=50){let a=r.getImageData,i=G in a?a[G]:a,o=new Uint32Array(i.call(r,n,s,Math.min(50,t.width-n),Math.min(50,t.height-s)).data.buffer);if(o.some(t=>0!==t))return!1}return!0}function getInputType(t){let r=t.type;return t.hasAttribute("data-rr-is-password")?"password":r?toLowerCase(r):null}function getInputValue(t,r,n){return"INPUT"===r&&("radio"===n||"checkbox"===n)?t.getAttribute("value")||"":t.value}let Z=1,P=RegExp("[^a-z0-9-_:]");function genId(){return Z++}function getValidTagName(t){if(t instanceof HTMLFormElement)return"form";let r=toLowerCase(t.tagName);return P.test(r)?"div":r}function extractOrigin(t){return(t.indexOf("//")>-1?t.split("/").slice(0,3).join("/"):t.split("/")[0]).split("?")[0]}let V=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,H=/^(?:[a-z+]+:)?\/\//i,K=/^www\..*/i,Y=/^(data:)([^,]*),(.*)/i;function absoluteToStylesheet(t,r){return(t||"").replace(V,(t,n,s,a,i,o)=>{let l=s||i||o,d=n||a||"";if(!l)return t;if(H.test(l)||K.test(l)||Y.test(l))return`url(${d}${l}${d})`;if("/"===l[0])return`url(${d}${extractOrigin(r)+l}${d})`;let c=r.split("/"),u=l.split("/");for(let t of(c.pop(),u))"."!==t&&(".."===t?c.pop():c.push(t));return`url(${d}${c.join("/")}${d})`})}let J=/^[^ \t\n\r\u000c]+/,j=/^[, \t\n\r\u000c]+/;function getAbsoluteSrcsetString(t,r){if(""===r.trim())return r;let n=0;function collectCharacters(t){let s;let a=t.exec(r.substring(n));return a?(s=a[0],n+=s.length,s):""}let s=[];for(;collectCharacters(j),!(n>=r.length);){let a=collectCharacters(J);if(","===a.slice(-1))a=absoluteToDoc(t,a.substring(0,a.length-1)),s.push(a);else{let i="";a=absoluteToDoc(t,a);let o=!1;for(;;){let t=r.charAt(n);if(""===t){s.push((a+i).trim());break}if(o)")"===t&&(o=!1);else{if(","===t){n+=1,s.push((a+i).trim());break}"("===t&&(o=!0)}i+=t,n+=1}}}return s.join(", ")}function absoluteToDoc(t,r){if(!r||""===r.trim())return r;let n=t.createElement("a");return n.href=r,n.href}function isSVGElement(t){return!!("svg"===t.tagName||t.ownerSVGElement)}function getHref(){let t=document.createElement("a");return t.href="",t.href}function transformAttribute(t,r,n,s,a,i){return s?"src"!==n&&("href"!==n||"use"===r&&"#"===s[0])&&("xlink:href"!==n||"#"===s[0])&&("background"!==n||"table"!==r&&"td"!==r&&"th"!==r)?"srcset"===n?getAbsoluteSrcsetString(t,s):"style"===n?absoluteToStylesheet(s,getHref()):"object"===r&&"data"===n?absoluteToDoc(t,s):"function"==typeof i?i(n,s,a):s:absoluteToDoc(t,s):s}function ignoreAttribute(t,r,n){return("video"===t||"audio"===t)&&"autoplay"===r}function _isBlockedElement(t,r,n,s){try{if(s&&t.matches(s))return!1;if("string"==typeof r){if(t.classList.contains(r))return!0}else for(let n=t.classList.length;n--;){let s=t.classList[n];if(r.test(s))return!0}if(n)return t.matches(n)}catch(t){}return!1}function elementClassMatchesRegex(t,r){for(let n=t.classList.length;n--;){let s=t.classList[n];if(r.test(s))return!0}return!1}function distanceToMatch(t,r,n=1/0,s=0){return!t||t.nodeType!==t.ELEMENT_NODE||s>n?-1:r(t)?s:distanceToMatch(t.parentNode,r,n,s+1)}function createMatchPredicate(t,r){return n=>{if(null===n)return!1;if(t){if("string"==typeof t){if(n.matches(`.${t}`))return!0}else if(elementClassMatchesRegex(n,t))return!0}return!!(r&&n.matches(r))}}function needMaskingText(t,r,n,s,a,i){try{let o=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(null===o)return!1;let l=-1,d=-1;if(i){if((d=distanceToMatch(o,createMatchPredicate(s,a)))<0)return!0;l=distanceToMatch(o,createMatchPredicate(r,n),d>=0?d:1/0)}else{if((l=distanceToMatch(o,createMatchPredicate(r,n)))<0)return!1;d=distanceToMatch(o,createMatchPredicate(s,a),l>=0?l:1/0)}return l>=0?!(d>=0)||l<=d:!(d>=0)&&!!i}catch(t){}return!!i}function onceIframeLoaded(t,r,n){let s;let a=t.contentWindow;if(!a)return;let i=!1;try{s=a.document.readyState}catch(t){return}if("complete"!==s){let s=setTimeout(()=>{i||(r(),i=!0)},n);t.addEventListener("load",()=>{clearTimeout(s),i=!0,r()});return}let o="about:blank";if(a.location.href!==o||t.src===o||""===t.src)return setTimeout(r,0),t.addEventListener("load",r);t.addEventListener("load",r)}function onceStylesheetLoaded(t,r,n){let s,a=!1;try{s=t.sheet}catch(t){return}if(s)return;let i=setTimeout(()=>{a||(r(),a=!0)},n);t.addEventListener("load",()=>{clearTimeout(i),a=!0,r()})}function serializeNode(t,r){let{doc:n,mirror:s,blockClass:a,blockSelector:i,unblockSelector:o,maskAllText:l,maskAttributeFn:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,inlineStylesheet:g,maskInputOptions:m={},maskTextFn:f,maskInputFn:_,dataURLOptions:y={},inlineImages:I,recordCanvas:S,keepIframeSrcFn:C,newlyAddedElement:v=!1}=r,w=getRootId(n,s);switch(t.nodeType){case t.DOCUMENT_NODE:if("CSS1Compat"!==t.compatMode)return{type:b.Document,childNodes:[],compatMode:t.compatMode};return{type:b.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:b.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:w};case t.ELEMENT_NODE:return serializeElementNode(t,{doc:n,blockClass:a,blockSelector:i,unblockSelector:o,inlineStylesheet:g,maskAttributeFn:d,maskInputOptions:m,maskInputFn:_,dataURLOptions:y,inlineImages:I,recordCanvas:S,keepIframeSrcFn:C,newlyAddedElement:v,rootId:w,maskAllText:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p});case t.TEXT_NODE:return serializeTextNode(t,{maskAllText:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,maskTextFn:f,maskInputOptions:m,maskInputFn:_,rootId:w});case t.CDATA_SECTION_NODE:return{type:b.CDATA,textContent:"",rootId:w};case t.COMMENT_NODE:return{type:b.Comment,textContent:t.textContent||"",rootId:w};default:return!1}}function getRootId(t,r){if(!r.hasNode(t))return;let n=r.getId(t);return 1===n?void 0:n}function serializeTextNode(t,r){var n;let{maskAllText:s,maskTextClass:a,unmaskTextClass:i,maskTextSelector:o,unmaskTextSelector:l,maskTextFn:d,maskInputOptions:c,maskInputFn:u,rootId:h}=r,p=t.parentNode&&t.parentNode.tagName,g=t.textContent,m="STYLE"===p||void 0,f="SCRIPT"===p||void 0,_="TEXTAREA"===p||void 0;if(m&&g){try{t.nextSibling||t.previousSibling||(null===(n=t.parentNode.sheet)||void 0===n?void 0:n.cssRules)&&(g=stringifyStylesheet(t.parentNode.sheet))}catch(r){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${r}`,t)}g=absoluteToStylesheet(g,getHref())}f&&(g="SCRIPT_PLACEHOLDER");let y=needMaskingText(t,a,o,i,l,s);if(m||f||_||!g||!y||(g=d?d(g):g.replace(/[\S]/g,"*")),_&&g&&(c.textarea||y)&&(g=u?u(g,t.parentNode):g.replace(/[\S]/g,"*")),"OPTION"===p&&g){let r=shouldMaskInput({type:null,tagName:p,maskInputOptions:c});g=maskInputValue({isMasked:needMaskingText(t,a,o,i,l,r),element:t,value:g,maskInputFn:u})}return{type:b.Text,textContent:g||"",isStyle:m,rootId:h}}function serializeElementNode(t,r){let n;let{doc:i,blockClass:o,blockSelector:l,unblockSelector:d,inlineStylesheet:c,maskInputOptions:u={},maskAttributeFn:h,maskInputFn:p,dataURLOptions:g={},inlineImages:m,recordCanvas:f,keepIframeSrcFn:_,newlyAddedElement:y=!1,rootId:I,maskAllText:S,maskTextClass:C,unmaskTextClass:v,maskTextSelector:w,unmaskTextSelector:E}=r,k=_isBlockedElement(t,o,l,d),A=getValidTagName(t),R={},T=t.attributes.length;for(let r=0;r<T;r++){let n=t.attributes[r];ignoreAttribute(A,n.name,n.value)||(R[n.name]=transformAttribute(i,A,toLowerCase(n.name),n.value,t,h))}if("link"===A&&c){let r=Array.from(i.styleSheets).find(r=>r.href===t.href),n=null;r&&(n=stringifyStylesheet(r)),n&&(delete R.rel,delete R.href,R._cssText=absoluteToStylesheet(n,r.href))}if("style"===A&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){let r=stringifyStylesheet(t.sheet);r&&(R._cssText=absoluteToStylesheet(r,getHref()))}if("input"===A||"textarea"===A||"select"===A||"option"===A){let r=getInputType(t),n=getInputValue(t,toUpperCase(A),r),s=t.checked;if("submit"!==r&&"button"!==r&&n){let s=needMaskingText(t,C,w,v,E,shouldMaskInput({type:r,tagName:toUpperCase(A),maskInputOptions:u}));R.value=maskInputValue({isMasked:s,element:t,value:n,maskInputFn:p})}s&&(R.checked=s)}if("option"===A&&(t.selected&&!u.select?R.selected=!0:delete R.selected),"canvas"===A&&f){if("2d"===t.__context)is2DCanvasBlank(t)||(R.rr_dataURL=t.toDataURL(g.type,g.quality));else if(!("__context"in t)){let r=t.toDataURL(g.type,g.quality),n=document.createElement("canvas");n.width=t.width,n.height=t.height;let s=n.toDataURL(g.type,g.quality);r!==s&&(R.rr_dataURL=r)}}if("img"===A&&m){s||(a=(s=i.createElement("canvas")).getContext("2d"));let r=t.crossOrigin;t.crossOrigin="anonymous";let recordInlineImage=()=>{t.removeEventListener("load",recordInlineImage);try{s.width=t.naturalWidth,s.height=t.naturalHeight,a.drawImage(t,0,0),R.rr_dataURL=s.toDataURL(g.type,g.quality)}catch(r){console.warn(`Cannot inline img src=${t.currentSrc}! Error: ${r}`)}r?R.crossOrigin=r:t.removeAttribute("crossorigin")};t.complete&&0!==t.naturalWidth?recordInlineImage():t.addEventListener("load",recordInlineImage)}if(("audio"===A||"video"===A)&&(R.rr_mediaState=t.paused?"paused":"played",R.rr_mediaCurrentTime=t.currentTime),!y&&(t.scrollLeft&&(R.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(R.rr_scrollTop=t.scrollTop)),k){let{width:r,height:n}=t.getBoundingClientRect();R={class:R.class,rr_width:`${r}px`,rr_height:`${n}px`}}"iframe"!==A||_(R.src)||(t.contentDocument||(R.rr_src=R.src),delete R.src);try{customElements.get(A)&&(n=!0)}catch(t){}return{type:b.Element,tagName:A,attributes:R,childNodes:[],isSVG:isSVGElement(t)||void 0,needBlock:k,rootId:I,isCustom:n}}function lowerIfExists(t){return null==t?"":t.toLowerCase()}function slimDOMExcluded(t,r){if(r.comment&&t.type===b.Comment)return!0;if(t.type===b.Element){if(r.script&&("script"===t.tagName||"link"===t.tagName&&("preload"===t.attributes.rel||"modulepreload"===t.attributes.rel)&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js"))||r.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(lowerIfExists(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===lowerIfExists(t.attributes.name)||"icon"===lowerIfExists(t.attributes.rel)||"apple-touch-icon"===lowerIfExists(t.attributes.rel)||"shortcut icon"===lowerIfExists(t.attributes.rel))))return!0;if("meta"===t.tagName){if(r.headMetaDescKeywords&&lowerIfExists(t.attributes.name).match(/^description|keywords$/)||r.headMetaSocial&&(lowerIfExists(t.attributes.property).match(/^(og|twitter|fb):/)||lowerIfExists(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===lowerIfExists(t.attributes.name)))return!0;if(r.headMetaRobots&&("robots"===lowerIfExists(t.attributes.name)||"googlebot"===lowerIfExists(t.attributes.name)||"bingbot"===lowerIfExists(t.attributes.name)))return!0;if(r.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;else if(r.headMetaAuthorship&&("author"===lowerIfExists(t.attributes.name)||"generator"===lowerIfExists(t.attributes.name)||"framework"===lowerIfExists(t.attributes.name)||"publisher"===lowerIfExists(t.attributes.name)||"progid"===lowerIfExists(t.attributes.name)||lowerIfExists(t.attributes.property).match(/^article:/)||lowerIfExists(t.attributes.property).match(/^product:/)))return!0;else if(r.headMetaVerification&&("google-site-verification"===lowerIfExists(t.attributes.name)||"yandex-verification"===lowerIfExists(t.attributes.name)||"csrf-token"===lowerIfExists(t.attributes.name)||"p:domain_verify"===lowerIfExists(t.attributes.name)||"verify-v1"===lowerIfExists(t.attributes.name)||"verification"===lowerIfExists(t.attributes.name)||"shopify-checkout-api-token"===lowerIfExists(t.attributes.name)))return!0}}return!1}function serializeNodeWithId(t,r){let n;let{doc:s,mirror:a,blockClass:i,blockSelector:o,unblockSelector:l,maskAllText:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:g=!1,inlineStylesheet:m=!0,maskInputOptions:f={},maskAttributeFn:_,maskTextFn:y,maskInputFn:I,slimDOMOptions:S,dataURLOptions:C={},inlineImages:v=!1,recordCanvas:w=!1,onSerialize:E,onIframeLoad:k,iframeLoadTimeout:A=5e3,onStylesheetLoad:R,stylesheetLoadTimeout:T=5e3,keepIframeSrcFn:x=()=>!1,newlyAddedElement:M=!1}=r,{preserveWhiteSpace:N=!0}=r,D=serializeNode(t,{doc:s,mirror:a,blockClass:i,blockSelector:o,maskAllText:d,unblockSelector:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,inlineStylesheet:m,maskInputOptions:f,maskAttributeFn:_,maskTextFn:y,maskInputFn:I,dataURLOptions:C,inlineImages:v,recordCanvas:w,keepIframeSrcFn:x,newlyAddedElement:M});if(!D)return console.warn(t,"not serialized"),null;n=a.hasNode(t)?a.getId(t):!slimDOMExcluded(D,S)&&(N||D.type!==b.Text||D.isStyle||D.textContent.replace(/^\s+|\s+$/gm,"").length)?genId():-2;let O=Object.assign(D,{id:n});if(a.add(t,O),-2===n)return null;E&&E(t);let B=!g;if(O.type===b.Element){B=B&&!O.needBlock,delete O.needBlock;let r=t.shadowRoot;r&&isNativeShadowDom(r)&&(O.isShadowHost=!0)}if((O.type===b.Document||O.type===b.Element)&&B){S.headWhitespace&&O.type===b.Element&&"head"===O.tagName&&(N=!1);let r={doc:s,mirror:a,blockClass:i,blockSelector:o,maskAllText:d,unblockSelector:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:g,inlineStylesheet:m,maskInputOptions:f,maskAttributeFn:_,maskTextFn:y,maskInputFn:I,slimDOMOptions:S,dataURLOptions:C,inlineImages:v,recordCanvas:w,preserveWhiteSpace:N,onSerialize:E,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:R,stylesheetLoadTimeout:T,keepIframeSrcFn:x};for(let n of Array.from(t.childNodes)){let t=serializeNodeWithId(n,r);t&&O.childNodes.push(t)}if(isElement$1(t)&&t.shadowRoot)for(let n of Array.from(t.shadowRoot.childNodes)){let s=serializeNodeWithId(n,r);s&&(isNativeShadowDom(t.shadowRoot)&&(s.isShadow=!0),O.childNodes.push(s))}}return t.parentNode&&isShadowRoot(t.parentNode)&&isNativeShadowDom(t.parentNode)&&(O.isShadow=!0),O.type===b.Element&&"iframe"===O.tagName&&onceIframeLoaded(t,()=>{let r=t.contentDocument;if(r&&k){let n=serializeNodeWithId(r,{doc:r,mirror:a,blockClass:i,blockSelector:o,unblockSelector:l,maskAllText:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:!1,inlineStylesheet:m,maskInputOptions:f,maskAttributeFn:_,maskTextFn:y,maskInputFn:I,slimDOMOptions:S,dataURLOptions:C,inlineImages:v,recordCanvas:w,preserveWhiteSpace:N,onSerialize:E,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:R,stylesheetLoadTimeout:T,keepIframeSrcFn:x});n&&k(t,n)}},A),O.type===b.Element&&"link"===O.tagName&&"stylesheet"===O.attributes.rel&&onceStylesheetLoaded(t,()=>{if(R){let r=serializeNodeWithId(t,{doc:s,mirror:a,blockClass:i,blockSelector:o,unblockSelector:l,maskAllText:d,maskTextClass:c,unmaskTextClass:u,maskTextSelector:h,unmaskTextSelector:p,skipChild:!1,inlineStylesheet:m,maskInputOptions:f,maskAttributeFn:_,maskTextFn:y,maskInputFn:I,slimDOMOptions:S,dataURLOptions:C,inlineImages:v,recordCanvas:w,preserveWhiteSpace:N,onSerialize:E,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:R,stylesheetLoadTimeout:T,keepIframeSrcFn:x});r&&R(t,r)}},T),O}function snapshot(t,r){let{mirror:n=new Mirror,blockClass:s="rr-block",blockSelector:a=null,unblockSelector:i=null,maskAllText:o=!1,maskTextClass:l="rr-mask",unmaskTextClass:d=null,maskTextSelector:c=null,unmaskTextSelector:u=null,inlineStylesheet:h=!0,inlineImages:p=!1,recordCanvas:g=!1,maskAllInputs:m=!1,maskAttributeFn:f,maskTextFn:_,maskInputFn:y,slimDOM:b=!1,dataURLOptions:I,preserveWhiteSpace:S,onSerialize:C,onIframeLoad:v,iframeLoadTimeout:w,onStylesheetLoad:E,stylesheetLoadTimeout:k,keepIframeSrcFn:A=()=>!1}=r||{},R=!0===m?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===m?{}:m,T=!0===b||"all"===b?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===b,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===b?{}:b;return serializeNodeWithId(t,{doc:t,mirror:n,blockClass:s,blockSelector:a,unblockSelector:i,maskAllText:o,maskTextClass:l,unmaskTextClass:d,maskTextSelector:c,unmaskTextSelector:u,skipChild:!1,inlineStylesheet:h,maskInputOptions:R,maskAttributeFn:f,maskTextFn:_,maskInputFn:y,slimDOMOptions:T,dataURLOptions:I,inlineImages:p,recordCanvas:g,preserveWhiteSpace:S,onSerialize:C,onIframeLoad:v,iframeLoadTimeout:w,onStylesheetLoad:E,stylesheetLoadTimeout:k,keepIframeSrcFn:A,newlyAddedElement:!1})}function on(t,r,n=document){let s={capture:!0,passive:!0};return n.addEventListener(t,r,s),()=>n.removeEventListener(t,r,s)}let X="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",q={map:{},getId:()=>(console.error(X),-1),getNode:()=>(console.error(X),null),removeNodeFromMap(){console.error(X)},has:()=>(console.error(X),!1),reset(){console.error(X)}};function throttle$1(t,r,n={}){let s=null,a=0;return function(...i){let o=Date.now();a||!1!==n.leading||(a=o);let l=r-(o-a),d=this;l<=0||l>r?(s&&(clearTimeout(s),s=null),a=o,t.apply(d,i)):s||!1===n.trailing||(s=setTimeout(()=>{a=!1===n.leading?0:Date.now(),s=null,t.apply(d,i)},l))}}function hookSetter(t,r,n,s,a=window){let i=a.Object.getOwnPropertyDescriptor(t,r);return a.Object.defineProperty(t,r,s?n:{set(t){setTimeout(()=>{n.set.call(this,t)},0),i&&i.set&&i.set.call(this,t)}}),()=>hookSetter(t,r,i||{},!0)}function patch(t,r,n){try{if(!(r in t))return()=>{};let s=t[r],a=n(s);return"function"==typeof a&&(a.prototype=a.prototype||{},Object.defineProperties(a,{__rrweb_original__:{enumerable:!1,value:s}})),t[r]=a,()=>{t[r]=s}}catch(t){return()=>{}}}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(q=new Proxy(q,{get:(t,r,n)=>("map"===r&&console.error(X),Reflect.get(t,r,n))}));let Q=Date.now;function getWindowScroll(t){var r,n,s,a,i,o;let l=t.document;return{left:l.scrollingElement?l.scrollingElement.scrollLeft:void 0!==t.pageXOffset?t.pageXOffset:(null==l?void 0:l.documentElement.scrollLeft)||(null===(n=null===(r=null==l?void 0:l.body)||void 0===r?void 0:r.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===(s=null==l?void 0:l.body)||void 0===s?void 0:s.scrollLeft)||0,top:l.scrollingElement?l.scrollingElement.scrollTop:void 0!==t.pageYOffset?t.pageYOffset:(null==l?void 0:l.documentElement.scrollTop)||(null===(i=null===(a=null==l?void 0:l.body)||void 0===a?void 0:a.parentElement)||void 0===i?void 0:i.scrollTop)||(null===(o=null==l?void 0:l.body)||void 0===o?void 0:o.scrollTop)||0}}function getWindowHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function getWindowWidth(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function isBlocked(t,r,n,s,a){if(!t)return!1;let i=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(!i)return!1;let o=createMatchPredicate(r,n);if(!a){let t=s&&i.matches(s);return o(i)&&!t}let l=distanceToMatch(i,o),d=-1;return!(l<0)&&(s&&(d=distanceToMatch(i,createMatchPredicate(null,s))),l>-1&&d<0||l<d)}function isSerialized(t,r){return -1!==r.getId(t)}function isIgnored(t,r){return -2===r.getId(t)}function isAncestorRemoved(t,r){if(isShadowRoot(t))return!1;let n=r.getId(t);return!r.has(n)||(!t.parentNode||t.parentNode.nodeType!==t.DOCUMENT_NODE)&&(!t.parentNode||isAncestorRemoved(t.parentNode,r))}function legacy_isTouchEvent(t){return!!t.changedTouches}function polyfill(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let r=t[0];if(!(0 in t))throw TypeError("1 argument is required");do if(this===r)return!0;while(r=r&&r.parentNode);return!1})}function isSerializedIframe(t,r){return!!("IFRAME"===t.nodeName&&r.getMeta(t))}function isSerializedStylesheet(t,r){return!!("LINK"===t.nodeName&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&"stylesheet"===t.getAttribute("rel")&&r.getMeta(t))}function hasShadowRoot(t){return!!(null==t?void 0:t.shadowRoot)}/[1-9][0-9]{12}/.test(Date.now().toString())||(Q=()=>new Date().getTime());let StyleSheetMirror=class StyleSheetMirror{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var r;return null!==(r=this.styleIDMap.get(t))&&void 0!==r?r:-1}has(t){return this.styleIDMap.has(t)}add(t,r){let n;return this.has(t)?this.getId(t):(n=void 0===r?this.id++:r,this.styleIDMap.set(t,n),this.idStyleMap.set(n,t),n)}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}};function getShadowHost(t){var r,n;let s=null;return(null===(n=null===(r=t.getRootNode)||void 0===r?void 0:r.call(t))||void 0===n?void 0:n.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&t.getRootNode().host&&(s=t.getRootNode().host),s}function getRootShadowHost(t){let r,n=t;for(;r=getShadowHost(n);)n=r;return n}function shadowHostInDom(t){let r=t.ownerDocument;if(!r)return!1;let n=getRootShadowHost(t);return r.contains(n)}function inDom(t){let r=t.ownerDocument;return!!r&&(r.contains(t)||shadowHostInDom(t))}var $=((p=$||{})[p.DomContentLoaded=0]="DomContentLoaded",p[p.Load=1]="Load",p[p.FullSnapshot=2]="FullSnapshot",p[p.IncrementalSnapshot=3]="IncrementalSnapshot",p[p.Meta=4]="Meta",p[p.Custom=5]="Custom",p[p.Plugin=6]="Plugin",p),ee=((g=ee||{})[g.Mutation=0]="Mutation",g[g.MouseMove=1]="MouseMove",g[g.MouseInteraction=2]="MouseInteraction",g[g.Scroll=3]="Scroll",g[g.ViewportResize=4]="ViewportResize",g[g.Input=5]="Input",g[g.TouchMove=6]="TouchMove",g[g.MediaInteraction=7]="MediaInteraction",g[g.StyleSheetRule=8]="StyleSheetRule",g[g.CanvasMutation=9]="CanvasMutation",g[g.Font=10]="Font",g[g.Log=11]="Log",g[g.Drag=12]="Drag",g[g.StyleDeclaration=13]="StyleDeclaration",g[g.Selection=14]="Selection",g[g.AdoptedStyleSheet=15]="AdoptedStyleSheet",g[g.CustomElement=16]="CustomElement",g),et=((m=et||{})[m.MouseUp=0]="MouseUp",m[m.MouseDown=1]="MouseDown",m[m.Click=2]="Click",m[m.ContextMenu=3]="ContextMenu",m[m.DblClick=4]="DblClick",m[m.Focus=5]="Focus",m[m.Blur=6]="Blur",m[m.TouchStart=7]="TouchStart",m[m.TouchMove_Departed=8]="TouchMove_Departed",m[m.TouchEnd=9]="TouchEnd",m[m.TouchCancel=10]="TouchCancel",m),er=((f=er||{})[f.Mouse=0]="Mouse",f[f.Pen=1]="Pen",f[f.Touch=2]="Touch",f),en=((_=en||{})[_["2D"]=0]="2D",_[_.WebGL=1]="WebGL",_[_.WebGL2=2]="WebGL2",_);let DoubleLinkedList=class DoubleLinkedList{constructor(){this.length=0,this.head=null,this.tail=null}get(t){if(t>=this.length)throw Error("Position outside of list range");let r=this.head;for(let n=0;n<t;n++)r=(null==r?void 0:r.next)||null;return r}addNode(t){let r={value:t,previous:null,next:null};if(t.__ln=r,t.previousSibling&&"__ln"in t.previousSibling){let n=t.previousSibling.__ln.next;r.next=n,r.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=r,n&&(n.previous=r)}else if(t.nextSibling&&"__ln"in t.nextSibling&&t.nextSibling.__ln.previous){let n=t.nextSibling.__ln.previous;r.previous=n,r.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=r,n&&(n.next=r)}else this.head&&(this.head.previous=r),r.next=this.head,this.head=r;null===r.next&&(this.tail=r),this.length++}removeNode(t){let r=t.__ln;this.head&&(r.previous?(r.previous.next=r.next,r.next?r.next.previous=r.previous:this.tail=r.previous):(this.head=r.next,this.head?this.head.previous=null:this.tail=null),t.__ln&&delete t.__ln,this.length--)}};let moveKey=(t,r)=>`${t}@${r}`;let MutationBuffer=class MutationBuffer{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;let t=[],r=new Set,n=new DoubleLinkedList,getNextId=t=>{let r=t,n=-2;for(;-2===n;)n=(r=r&&r.nextSibling)&&this.mirror.getId(r);return n},pushAdd=s=>{if(!s.parentNode||!inDom(s))return;let a=isShadowRoot(s.parentNode)?this.mirror.getId(getShadowHost(s)):this.mirror.getId(s.parentNode),i=getNextId(s);if(-1===a||-1===i)return n.addNode(s);let o=serializeNodeWithId(s,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:t=>{isSerializedIframe(t,this.mirror)&&this.iframeManager.addIframe(t),isSerializedStylesheet(t,this.mirror)&&this.stylesheetManager.trackLinkElement(t),hasShadowRoot(s)&&this.shadowDomManager.addShadowRoot(s.shadowRoot,this.doc)},onIframeLoad:(t,r)=>{this.iframeManager.attachIframe(t,r),this.shadowDomManager.observeAttachShadow(t)},onStylesheetLoad:(t,r)=>{this.stylesheetManager.attachLinkElement(t,r)}});o&&(t.push({parentId:a,nextId:i,node:o}),r.add(o.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(let t of this.movedSet)(!isParentRemoved(this.removes,t,this.mirror)||this.movedSet.has(t.parentNode))&&pushAdd(t);for(let t of this.addedSet)isAncestorInSet(this.droppedSet,t)||isParentRemoved(this.removes,t,this.mirror)?isAncestorInSet(this.movedSet,t)?pushAdd(t):this.droppedSet.add(t):pushAdd(t);let s=null;for(;n.length;){let t=null;if(s){let r=this.mirror.getId(s.value.parentNode),n=getNextId(s.value);-1!==r&&-1!==n&&(t=s)}if(!t){let r=n.tail;for(;r;){let n=r;if(r=r.previous,n){let r=this.mirror.getId(n.value.parentNode),s=getNextId(n.value);if(-1===s)continue;if(-1!==r){t=n;break}{let r=n.value;if(r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){let s=r.parentNode.host,a=this.mirror.getId(s);if(-1!==a){t=n;break}}}}}}if(!t){for(;n.head;)n.removeNode(n.head.value);break}s=t.previous,n.removeNode(t.value),pushAdd(t.value)}let a={texts:this.texts.map(t=>({id:this.mirror.getId(t.node),value:t.value})).filter(t=>!r.has(t.id)).filter(t=>this.mirror.has(t.id)),attributes:this.attributes.map(t=>{let{attributes:r}=t;if("string"==typeof r.style){let n=JSON.stringify(t.styleDiff),s=JSON.stringify(t._unchangedStyles);n.length<r.style.length&&(n+s).split("var(").length===r.style.split("var(").length&&(r.style=t.styleDiff)}return{id:this.mirror.getId(t.node),attributes:r}}).filter(t=>!r.has(t.id)).filter(t=>this.mirror.has(t.id)),removes:this.removes,adds:t};(a.texts.length||a.attributes.length||a.removes.length||a.adds.length)&&(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(a))},this.processMutation=t=>{let r;if(!isIgnored(t.target,this.mirror)){try{r=document.implementation.createHTMLDocument()}catch(t){r=this.doc}switch(t.type){case"characterData":{let r=t.target.textContent;isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||r===t.oldValue||this.texts.push({value:needMaskingText(t.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&r?this.maskTextFn?this.maskTextFn(r):r.replace(/[\S]/g,"*"):r,node:t.target});break}case"attributes":{let n=t.target,s=t.attributeName,a=t.target.getAttribute(s);if("value"===s){let r=getInputType(n),s=n.tagName;a=getInputValue(n,s,r);let i=shouldMaskInput({maskInputOptions:this.maskInputOptions,tagName:s,type:r}),o=needMaskingText(t.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,i);a=maskInputValue({isMasked:o,element:n,value:a,maskInputFn:this.maskInputFn})}if(isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||a===t.oldValue)return;let i=this.attributes.find(r=>r.node===t.target);if("IFRAME"===n.tagName&&"src"===s&&!this.keepIframeSrcFn(a)){if(n.contentDocument)return;s="rr_src"}if(i||(i={node:t.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(i)),"type"===s&&"INPUT"===n.tagName&&"password"===(t.oldValue||"").toLowerCase()&&n.setAttribute("data-rr-is-password","true"),!ignoreAttribute(n.tagName,s)&&(i.attributes[s]=transformAttribute(this.doc,toLowerCase(n.tagName),toLowerCase(s),a,n,this.maskAttributeFn),"style"===s)){let s=r.createElement("span");for(let r of(t.oldValue&&s.setAttribute("style",t.oldValue),Array.from(n.style))){let t=n.style.getPropertyValue(r),a=n.style.getPropertyPriority(r);t!==s.style.getPropertyValue(r)||a!==s.style.getPropertyPriority(r)?""===a?i.styleDiff[r]=t:i.styleDiff[r]=[t,a]:i._unchangedStyles[r]=[t,a]}for(let t of Array.from(s.style))""===n.style.getPropertyValue(t)&&(i.styleDiff[t]=!1)}break}case"childList":if(isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;t.addedNodes.forEach(r=>this.genAdds(r,t.target)),t.removedNodes.forEach(r=>{let n=this.mirror.getId(r),s=isShadowRoot(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);!(isBlocked(t.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||isIgnored(r,this.mirror))&&isSerialized(r,this.mirror)&&(this.addedSet.has(r)?(deepDelete(this.addedSet,r),this.droppedSet.add(r)):this.addedSet.has(t.target)&&-1===n||isAncestorRemoved(t.target,this.mirror)||(this.movedSet.has(r)&&this.movedMap[moveKey(n,s)]?deepDelete(this.movedSet,r):this.removes.push({parentId:s,id:n,isShadow:!!(isShadowRoot(t.target)&&isNativeShadowDom(t.target))||void 0})),this.mapRemoves.push(r))})}}},this.genAdds=(t,r)=>{if(!this.processedNodeManager.inOtherBuffer(t,this)&&!(this.addedSet.has(t)||this.movedSet.has(t))){if(this.mirror.hasNode(t)){if(isIgnored(t,this.mirror))return;this.movedSet.add(t);let n=null;r&&this.mirror.hasNode(r)&&(n=this.mirror.getId(r)),n&&-1!==n&&(this.movedMap[moveKey(this.mirror.getId(t),n)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);!isBlocked(t,this.blockClass,this.blockSelector,this.unblockSelector,!1)&&(t.childNodes.forEach(t=>this.genAdds(t)),hasShadowRoot(t)&&t.shadowRoot.childNodes.forEach(r=>{this.processedNodeManager.add(r,this),this.genAdds(r,t)}))}}}init(t){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(r=>{this[r]=t[r]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}};function deepDelete(t,r){t.delete(r),r.childNodes.forEach(r=>deepDelete(t,r))}function isParentRemoved(t,r,n){return 0!==t.length&&_isParentRemoved(t,r,n)}function _isParentRemoved(t,r,n){let{parentNode:s}=r;if(!s)return!1;let a=n.getId(s);return!!t.some(t=>t.id===a)||_isParentRemoved(t,s,n)}function isAncestorInSet(t,r){return 0!==t.size&&_isAncestorInSet(t,r)}function _isAncestorInSet(t,r){let{parentNode:n}=r;return!!n&&(!!t.has(n)||_isAncestorInSet(t,n))}function registerErrorHandler(t){i=t}function unregisterErrorHandler(){i=void 0}let callbackWrapper=t=>i?(...r)=>{try{return t(...r)}catch(t){if(i&&!0===i(t))return()=>{};throw t}}:t,es=[];function getEventTarget(t){try{if("composedPath"in t){let r=t.composedPath();if(r.length)return r[0]}else if("path"in t&&t.path.length)return t.path[0]}catch(t){}return t&&t.target}function initMutationObserver(t,r){var n,s;let a=new MutationBuffer;es.push(a),a.init(t);let i=window.MutationObserver||window.__rrMutationObserver,o=null===(s=null===(n=null==window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===s?void 0:s.call(n,"MutationObserver");o&&window[o]&&(i=window[o]);let l=new i(callbackWrapper(r=>{t.onMutation&&!1===t.onMutation(r)||a.processMutations.bind(a)(r)}));return l.observe(r,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),l}function initMoveObserver({mousemoveCb:t,sampling:r,doc:n,mirror:s}){let a;if(!1===r.mousemove)return()=>{};let i="number"==typeof r.mousemove?r.mousemove:50,o="number"==typeof r.mousemoveCallback?r.mousemoveCallback:500,l=[],d=throttle$1(callbackWrapper(r=>{let n=Date.now()-a;t(l.map(t=>(t.timeOffset-=n,t)),r),l=[],a=null}),o),c=callbackWrapper(throttle$1(callbackWrapper(t=>{let r=getEventTarget(t),{clientX:n,clientY:i}=legacy_isTouchEvent(t)?t.changedTouches[0]:t;a||(a=Q()),l.push({x:n,y:i,id:s.getId(r),timeOffset:Q()-a}),d("undefined"!=typeof DragEvent&&t instanceof DragEvent?ee.Drag:t instanceof MouseEvent?ee.MouseMove:ee.TouchMove)}),i,{trailing:!1})),u=[on("mousemove",c,n),on("touchmove",c,n),on("drag",c,n)];return callbackWrapper(()=>{u.forEach(t=>t())})}function initMouseInteractionObserver({mouseInteractionCb:t,doc:r,mirror:n,blockClass:s,blockSelector:a,unblockSelector:i,sampling:o}){if(!1===o.mouseInteraction)return()=>{};let l=!0===o.mouseInteraction||void 0===o.mouseInteraction?{}:o.mouseInteraction,d=[],c=null,getHandler=r=>o=>{let l=getEventTarget(o);if(isBlocked(l,s,a,i,!0))return;let d=null,u=r;if("pointerType"in o){switch(o.pointerType){case"mouse":d=er.Mouse;break;case"touch":d=er.Touch;break;case"pen":d=er.Pen}d===er.Touch?et[r]===et.MouseDown?u="TouchStart":et[r]===et.MouseUp&&(u="TouchEnd"):er.Pen}else legacy_isTouchEvent(o)&&(d=er.Touch);null!==d?(c=d,(u.startsWith("Touch")&&d===er.Touch||u.startsWith("Mouse")&&d===er.Mouse)&&(d=null)):et[r]===et.Click&&(d=c,c=null);let h=legacy_isTouchEvent(o)?o.changedTouches[0]:o;if(!h)return;let p=n.getId(l),{clientX:g,clientY:m}=h;callbackWrapper(t)(Object.assign({type:et[u],id:p,x:g,y:m},null!==d&&{pointerType:d}))};return Object.keys(et).filter(t=>Number.isNaN(Number(t))&&!t.endsWith("_Departed")&&!1!==l[t]).forEach(t=>{let n=toLowerCase(t),s=getHandler(t);if(window.PointerEvent)switch(et[t]){case et.MouseDown:case et.MouseUp:n=n.replace("mouse","pointer");break;case et.TouchStart:case et.TouchEnd:return}d.push(on(n,s,r))}),callbackWrapper(()=>{d.forEach(t=>t())})}function initScrollObserver({scrollCb:t,doc:r,mirror:n,blockClass:s,blockSelector:a,unblockSelector:i,sampling:o}){let l=callbackWrapper(throttle$1(callbackWrapper(o=>{let l=getEventTarget(o);if(!l||isBlocked(l,s,a,i,!0))return;let d=n.getId(l);if(l===r&&r.defaultView){let n=getWindowScroll(r.defaultView);t({id:d,x:n.left,y:n.top})}else t({id:d,x:l.scrollLeft,y:l.scrollTop})}),o.scroll||100));return on("scroll",l,r)}function initViewportResizeObserver({viewportResizeCb:t},{win:r}){let n=-1,s=-1,a=callbackWrapper(throttle$1(callbackWrapper(()=>{let r=getWindowHeight(),a=getWindowWidth();(n!==r||s!==a)&&(t({width:Number(a),height:Number(r)}),n=r,s=a)}),200));return on("resize",a,r)}function wrapEventWithUserTriggeredFlag(t,r){let n=Object.assign({},t);return r||delete n.userTriggered,n}let ea=["INPUT","TEXTAREA","SELECT"],ei=new WeakMap;function initInputObserver({inputCb:t,doc:r,mirror:n,blockClass:s,blockSelector:a,unblockSelector:i,ignoreClass:o,ignoreSelector:l,maskInputOptions:d,maskInputFn:c,sampling:u,userTriggeredOnInput:h,maskTextClass:p,unmaskTextClass:g,maskTextSelector:m,unmaskTextSelector:f}){function eventHandler(t){let n=getEventTarget(t),u=t.isTrusted,_=n&&toUpperCase(n.tagName);if("OPTION"===_&&(n=n.parentElement),!n||!_||0>ea.indexOf(_)||isBlocked(n,s,a,i,!0))return;let y=n;if(y.classList.contains(o)||l&&y.matches(l))return;let b=getInputType(n),I=getInputValue(y,_,b),S=!1,C=shouldMaskInput({maskInputOptions:d,tagName:_,type:b}),v=needMaskingText(n,p,m,g,f,C);("radio"===b||"checkbox"===b)&&(S=n.checked),I=maskInputValue({isMasked:v,element:n,value:I,maskInputFn:c}),cbWithDedup(n,callbackWrapper(wrapEventWithUserTriggeredFlag)({text:I,isChecked:S,userTriggered:u},h));let w=n.name;"radio"===b&&w&&S&&r.querySelectorAll(`input[type="radio"][name="${w}"]`).forEach(t=>{if(t!==n){let r=maskInputValue({isMasked:v,element:t,value:getInputValue(t,_,b),maskInputFn:c});cbWithDedup(t,callbackWrapper(wrapEventWithUserTriggeredFlag)({text:r,isChecked:!S,userTriggered:!1},h))}})}function cbWithDedup(r,s){let a=ei.get(r);if(!a||a.text!==s.text||a.isChecked!==s.isChecked){ei.set(r,s);let a=n.getId(r);callbackWrapper(t)(Object.assign(Object.assign({},s),{id:a}))}}let _="last"===u.input?["change"]:["input","change"],y=_.map(t=>on(t,callbackWrapper(eventHandler),r)),b=r.defaultView;if(!b)return()=>{y.forEach(t=>t())};let I=b.Object.getOwnPropertyDescriptor(b.HTMLInputElement.prototype,"value"),S=[[b.HTMLInputElement.prototype,"value"],[b.HTMLInputElement.prototype,"checked"],[b.HTMLSelectElement.prototype,"value"],[b.HTMLTextAreaElement.prototype,"value"],[b.HTMLSelectElement.prototype,"selectedIndex"],[b.HTMLOptionElement.prototype,"selected"]];return I&&I.set&&y.push(...S.map(t=>hookSetter(t[0],t[1],{set(){callbackWrapper(eventHandler)({target:this,isTrusted:!1})}},!1,b))),callbackWrapper(()=>{y.forEach(t=>t())})}function getNestedCSSRulePositions(t){return function(t,r){if(hasNestedCSSRule("CSSGroupingRule")&&t.parentRule instanceof CSSGroupingRule||hasNestedCSSRule("CSSMediaRule")&&t.parentRule instanceof CSSMediaRule||hasNestedCSSRule("CSSSupportsRule")&&t.parentRule instanceof CSSSupportsRule||hasNestedCSSRule("CSSConditionRule")&&t.parentRule instanceof CSSConditionRule){let n=Array.from(t.parentRule.cssRules),s=n.indexOf(t);r.unshift(s)}else if(t.parentStyleSheet){let n=Array.from(t.parentStyleSheet.cssRules),s=n.indexOf(t);r.unshift(s)}return r}(t,[])}function getIdAndStyleId(t,r,n){let s,a;return t?(t.ownerNode?s=r.getId(t.ownerNode):a=n.getId(t),{styleId:a,id:s}):{}}function initStyleSheetObserver({styleSheetRuleCb:t,mirror:r,stylesheetManager:n},{win:s}){let a,i;if(!s.CSSStyleSheet||!s.CSSStyleSheet.prototype)return()=>{};let o=s.CSSStyleSheet.prototype.insertRule;s.CSSStyleSheet.prototype.insertRule=new Proxy(o,{apply:callbackWrapper((s,a,i)=>{let[o,l]=i,{id:d,styleId:c}=getIdAndStyleId(a,r,n.styleMirror);return(d&&-1!==d||c&&-1!==c)&&t({id:d,styleId:c,adds:[{rule:o,index:l}]}),s.apply(a,i)})});let l=s.CSSStyleSheet.prototype.deleteRule;s.CSSStyleSheet.prototype.deleteRule=new Proxy(l,{apply:callbackWrapper((s,a,i)=>{let[o]=i,{id:l,styleId:d}=getIdAndStyleId(a,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,removes:[{index:o}]}),s.apply(a,i)})}),s.CSSStyleSheet.prototype.replace&&(a=s.CSSStyleSheet.prototype.replace,s.CSSStyleSheet.prototype.replace=new Proxy(a,{apply:callbackWrapper((s,a,i)=>{let[o]=i,{id:l,styleId:d}=getIdAndStyleId(a,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,replace:o}),s.apply(a,i)})})),s.CSSStyleSheet.prototype.replaceSync&&(i=s.CSSStyleSheet.prototype.replaceSync,s.CSSStyleSheet.prototype.replaceSync=new Proxy(i,{apply:callbackWrapper((s,a,i)=>{let[o]=i,{id:l,styleId:d}=getIdAndStyleId(a,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,replaceSync:o}),s.apply(a,i)})}));let d={};canMonkeyPatchNestedCSSRule("CSSGroupingRule")?d.CSSGroupingRule=s.CSSGroupingRule:(canMonkeyPatchNestedCSSRule("CSSMediaRule")&&(d.CSSMediaRule=s.CSSMediaRule),canMonkeyPatchNestedCSSRule("CSSConditionRule")&&(d.CSSConditionRule=s.CSSConditionRule),canMonkeyPatchNestedCSSRule("CSSSupportsRule")&&(d.CSSSupportsRule=s.CSSSupportsRule));let c={};return Object.entries(d).forEach(([s,a])=>{c[s]={insertRule:a.prototype.insertRule,deleteRule:a.prototype.deleteRule},a.prototype.insertRule=new Proxy(c[s].insertRule,{apply:callbackWrapper((s,a,i)=>{let[o,l]=i,{id:d,styleId:c}=getIdAndStyleId(a.parentStyleSheet,r,n.styleMirror);return(d&&-1!==d||c&&-1!==c)&&t({id:d,styleId:c,adds:[{rule:o,index:[...getNestedCSSRulePositions(a),l||0]}]}),s.apply(a,i)})}),a.prototype.deleteRule=new Proxy(c[s].deleteRule,{apply:callbackWrapper((s,a,i)=>{let[o]=i,{id:l,styleId:d}=getIdAndStyleId(a.parentStyleSheet,r,n.styleMirror);return(l&&-1!==l||d&&-1!==d)&&t({id:l,styleId:d,removes:[{index:[...getNestedCSSRulePositions(a),o]}]}),s.apply(a,i)})})}),callbackWrapper(()=>{s.CSSStyleSheet.prototype.insertRule=o,s.CSSStyleSheet.prototype.deleteRule=l,a&&(s.CSSStyleSheet.prototype.replace=a),i&&(s.CSSStyleSheet.prototype.replaceSync=i),Object.entries(d).forEach(([t,r])=>{r.prototype.insertRule=c[t].insertRule,r.prototype.deleteRule=c[t].deleteRule})})}function initAdoptedStyleSheetObserver({mirror:t,stylesheetManager:r},n){var s,a,i;let o=null;o="#document"===n.nodeName?t.getId(n):t.getId(n.host);let l="#document"===n.nodeName?null===(s=n.defaultView)||void 0===s?void 0:s.Document:null===(i=null===(a=n.ownerDocument)||void 0===a?void 0:a.defaultView)||void 0===i?void 0:i.ShadowRoot,d=(null==l?void 0:l.prototype)?Object.getOwnPropertyDescriptor(null==l?void 0:l.prototype,"adoptedStyleSheets"):void 0;return null!==o&&-1!==o&&l&&d?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:d.configurable,enumerable:d.enumerable,get(){var t;return null===(t=d.get)||void 0===t?void 0:t.call(this)},set(t){var n;let s=null===(n=d.set)||void 0===n?void 0:n.call(this,t);if(null!==o&&-1!==o)try{r.adoptStyleSheets(t,o)}catch(t){}return s}}),callbackWrapper(()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:d.configurable,enumerable:d.enumerable,get:d.get,set:d.set})})):()=>{}}function initStyleDeclarationObserver({styleDeclarationCb:t,mirror:r,ignoreCSSAttributes:n,stylesheetManager:s},{win:a}){let i=a.CSSStyleDeclaration.prototype.setProperty;a.CSSStyleDeclaration.prototype.setProperty=new Proxy(i,{apply:callbackWrapper((a,o,l)=>{var d;let[c,u,h]=l;if(n.has(c))return i.apply(o,[c,u,h]);let{id:p,styleId:g}=getIdAndStyleId(null===(d=o.parentRule)||void 0===d?void 0:d.parentStyleSheet,r,s.styleMirror);return(p&&-1!==p||g&&-1!==g)&&t({id:p,styleId:g,set:{property:c,value:u,priority:h},index:getNestedCSSRulePositions(o.parentRule)}),a.apply(o,l)})});let o=a.CSSStyleDeclaration.prototype.removeProperty;return a.CSSStyleDeclaration.prototype.removeProperty=new Proxy(o,{apply:callbackWrapper((a,i,l)=>{var d;let[c]=l;if(n.has(c))return o.apply(i,[c]);let{id:u,styleId:h}=getIdAndStyleId(null===(d=i.parentRule)||void 0===d?void 0:d.parentStyleSheet,r,s.styleMirror);return(u&&-1!==u||h&&-1!==h)&&t({id:u,styleId:h,remove:{property:c},index:getNestedCSSRulePositions(i.parentRule)}),a.apply(i,l)})}),callbackWrapper(()=>{a.CSSStyleDeclaration.prototype.setProperty=i,a.CSSStyleDeclaration.prototype.removeProperty=o})}function initMediaInteractionObserver({mediaInteractionCb:t,blockClass:r,blockSelector:n,unblockSelector:s,mirror:a,sampling:i,doc:o}){let l=callbackWrapper(o=>throttle$1(callbackWrapper(i=>{let l=getEventTarget(i);if(!l||isBlocked(l,r,n,s,!0))return;let{currentTime:d,volume:c,muted:u,playbackRate:h}=l;t({type:o,id:a.getId(l),currentTime:d,volume:c,muted:u,playbackRate:h})}),i.media||500)),d=[on("play",l(0),o),on("pause",l(1),o),on("seeked",l(2),o),on("volumechange",l(3),o),on("ratechange",l(4),o)];return callbackWrapper(()=>{d.forEach(t=>t())})}function initFontObserver({fontCb:t,doc:r}){let n=r.defaultView;if(!n)return()=>{};let s=[],a=new WeakMap,i=n.FontFace;n.FontFace=function(t,r,n){let s=new i(t,r,n);return a.set(s,{family:t,buffer:"string"!=typeof r,descriptors:n,fontSource:"string"==typeof r?r:JSON.stringify(Array.from(new Uint8Array(r)))}),s};let o=patch(r.fonts,"add",function(r){return function(n){return setTimeout(callbackWrapper(()=>{let r=a.get(n);r&&(t(r),a.delete(n))}),0),r.apply(this,[n])}});return s.push(()=>{n.FontFace=i}),s.push(o),callbackWrapper(()=>{s.forEach(t=>t())})}function initSelectionObserver(t){let{doc:r,mirror:n,blockClass:s,blockSelector:a,unblockSelector:i,selectionCb:o}=t,l=!0,d=callbackWrapper(()=>{let t=r.getSelection();if(!t||l&&(null==t?void 0:t.isCollapsed))return;l=t.isCollapsed||!1;let d=[],c=t.rangeCount||0;for(let r=0;r<c;r++){let o=t.getRangeAt(r),{startContainer:l,startOffset:c,endContainer:u,endOffset:h}=o,p=isBlocked(l,s,a,i,!0)||isBlocked(u,s,a,i,!0);p||d.push({start:n.getId(l),startOffset:c,end:n.getId(u),endOffset:h})}o({ranges:d})});return d(),on("selectionchange",d)}function initCustomElementObserver({doc:t,customElementCb:r}){let n=t.defaultView;if(!n||!n.customElements)return()=>{};let s=patch(n.customElements,"define",function(t){return function(n,s,a){try{r({define:{name:n}})}catch(t){}return t.apply(this,[n,s,a])}});return s}function mergeHooks(t,r){let{mutationCb:n,mousemoveCb:s,mouseInteractionCb:a,scrollCb:i,viewportResizeCb:o,inputCb:l,mediaInteractionCb:d,styleSheetRuleCb:c,styleDeclarationCb:u,canvasMutationCb:h,fontCb:p,selectionCb:g,customElementCb:m}=t;t.mutationCb=(...t)=>{r.mutation&&r.mutation(...t),n(...t)},t.mousemoveCb=(...t)=>{r.mousemove&&r.mousemove(...t),s(...t)},t.mouseInteractionCb=(...t)=>{r.mouseInteraction&&r.mouseInteraction(...t),a(...t)},t.scrollCb=(...t)=>{r.scroll&&r.scroll(...t),i(...t)},t.viewportResizeCb=(...t)=>{r.viewportResize&&r.viewportResize(...t),o(...t)},t.inputCb=(...t)=>{r.input&&r.input(...t),l(...t)},t.mediaInteractionCb=(...t)=>{r.mediaInteaction&&r.mediaInteaction(...t),d(...t)},t.styleSheetRuleCb=(...t)=>{r.styleSheetRule&&r.styleSheetRule(...t),c(...t)},t.styleDeclarationCb=(...t)=>{r.styleDeclaration&&r.styleDeclaration(...t),u(...t)},t.canvasMutationCb=(...t)=>{r.canvasMutation&&r.canvasMutation(...t),h(...t)},t.fontCb=(...t)=>{r.font&&r.font(...t),p(...t)},t.selectionCb=(...t)=>{r.selection&&r.selection(...t),g(...t)},t.customElementCb=(...t)=>{r.customElement&&r.customElement(...t),m(...t)}}function initObservers(t,r={}){let n=t.doc.defaultView;if(!n)return()=>{};mergeHooks(t,r);let s=initMutationObserver(t,t.doc),a=initMoveObserver(t),i=initMouseInteractionObserver(t),o=initScrollObserver(t),l=initViewportResizeObserver(t,{win:n}),d=initInputObserver(t),c=initMediaInteractionObserver(t),u=initStyleSheetObserver(t,{win:n}),h=initAdoptedStyleSheetObserver(t,t.doc),p=initStyleDeclarationObserver(t,{win:n}),g=t.collectFonts?initFontObserver(t):()=>{},m=initSelectionObserver(t),f=initCustomElementObserver(t),_=[];for(let r of t.plugins)_.push(r.observer(r.callback,n,r.options));return callbackWrapper(()=>{es.forEach(t=>t.reset()),s.disconnect(),a(),i(),o(),l(),d(),c(),u(),h(),p(),g(),m(),f(),_.forEach(t=>t())})}function hasNestedCSSRule(t){return void 0!==window[t]}function canMonkeyPatchNestedCSSRule(t){return!!(void 0!==window[t]&&window[t].prototype&&"insertRule"in window[t].prototype&&"deleteRule"in window[t].prototype)}let CrossOriginIframeMirror=class CrossOriginIframeMirror{constructor(t){this.generateIdFn=t,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(t,r,n,s){let a=n||this.getIdToRemoteIdMap(t),i=s||this.getRemoteIdToIdMap(t),o=a.get(r);return o||(o=this.generateIdFn(),a.set(r,o),i.set(o,r)),o}getIds(t,r){let n=this.getIdToRemoteIdMap(t),s=this.getRemoteIdToIdMap(t);return r.map(r=>this.getId(t,r,n,s))}getRemoteId(t,r,n){let s=n||this.getRemoteIdToIdMap(t);if("number"!=typeof r)return r;let a=s.get(r);return a||-1}getRemoteIds(t,r){let n=this.getRemoteIdToIdMap(t);return r.map(r=>this.getRemoteId(t,r,n))}reset(t){if(!t){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(t),this.iframeRemoteIdToIdMap.delete(t)}getIdToRemoteIdMap(t){let r=this.iframeIdToRemoteIdMap.get(t);return r||(r=new Map,this.iframeIdToRemoteIdMap.set(t,r)),r}getRemoteIdToIdMap(t){let r=this.iframeRemoteIdToIdMap.get(t);return r||(r=new Map,this.iframeRemoteIdToIdMap.set(t,r)),r}};let IframeManagerNoop=class IframeManagerNoop{constructor(){this.crossOriginIframeMirror=new CrossOriginIframeMirror(genId),this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}};let IframeManager=class IframeManager{constructor(t){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new CrossOriginIframeMirror(genId),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=t.mutationCb,this.wrappedEmit=t.wrappedEmit,this.stylesheetManager=t.stylesheetManager,this.recordCrossOriginIframes=t.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=t.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(t){this.iframes.set(t,!0),t.contentWindow&&this.crossOriginIframeMap.set(t.contentWindow,t)}addLoadListener(t){this.loadListener=t}attachIframe(t,r){var n;this.mutationCb({adds:[{parentId:this.mirror.getId(t),nextId:null,node:r}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,t),t.contentDocument&&t.contentDocument.adoptedStyleSheets&&t.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(t.contentDocument.adoptedStyleSheets,this.mirror.getId(t.contentDocument))}handleMessage(t){if("rrweb"!==t.data.type||t.origin!==t.data.origin)return;let r=t.source;if(!r)return;let n=this.crossOriginIframeMap.get(t.source);if(!n)return;let s=this.transformCrossOriginEvent(n,t.data.event);s&&this.wrappedEmit(s,t.data.isCheckout)}transformCrossOriginEvent(t,r){var n;switch(r.type){case $.FullSnapshot:{this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(r.data.node,t);let n=r.data.node.id;return this.crossOriginIframeRootIdMap.set(t,n),this.patchRootIdOnNode(r.data.node,n),{timestamp:r.timestamp,type:$.IncrementalSnapshot,data:{source:ee.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:r.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case $.Meta:case $.Load:case $.DomContentLoaded:break;case $.Plugin:return r;case $.Custom:return this.replaceIds(r.data.payload,t,["id","parentId","previousId","nextId"]),r;case $.IncrementalSnapshot:switch(r.data.source){case ee.Mutation:return r.data.adds.forEach(r=>{this.replaceIds(r,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(r.node,t);let n=this.crossOriginIframeRootIdMap.get(t);n&&this.patchRootIdOnNode(r.node,n)}),r.data.removes.forEach(r=>{this.replaceIds(r,t,["parentId","id"])}),r.data.attributes.forEach(r=>{this.replaceIds(r,t,["id"])}),r.data.texts.forEach(r=>{this.replaceIds(r,t,["id"])}),r;case ee.Drag:case ee.TouchMove:case ee.MouseMove:return r.data.positions.forEach(r=>{this.replaceIds(r,t,["id"])}),r;case ee.ViewportResize:return!1;case ee.MediaInteraction:case ee.MouseInteraction:case ee.Scroll:case ee.CanvasMutation:case ee.Input:return this.replaceIds(r.data,t,["id"]),r;case ee.StyleSheetRule:case ee.StyleDeclaration:return this.replaceIds(r.data,t,["id"]),this.replaceStyleIds(r.data,t,["styleId"]),r;case ee.Font:return r;case ee.Selection:return r.data.ranges.forEach(r=>{this.replaceIds(r,t,["start","end"])}),r;case ee.AdoptedStyleSheet:return this.replaceIds(r.data,t,["id"]),this.replaceStyleIds(r.data,t,["styleIds"]),null===(n=r.data.styles)||void 0===n||n.forEach(r=>{this.replaceStyleIds(r,t,["styleId"])}),r}}return!1}replace(t,r,n,s){for(let a of s)(Array.isArray(r[a])||"number"==typeof r[a])&&(Array.isArray(r[a])?r[a]=t.getIds(n,r[a]):r[a]=t.getId(n,r[a]));return r}replaceIds(t,r,n){return this.replace(this.crossOriginIframeMirror,t,r,n)}replaceStyleIds(t,r,n){return this.replace(this.crossOriginIframeStyleMirror,t,r,n)}replaceIdOnNode(t,r){this.replaceIds(t,r,["id","rootId"]),"childNodes"in t&&t.childNodes.forEach(t=>{this.replaceIdOnNode(t,r)})}patchRootIdOnNode(t,r){t.type===b.Document||t.rootId||(t.rootId=r),"childNodes"in t&&t.childNodes.forEach(t=>{this.patchRootIdOnNode(t,r)})}};let ShadowDomManagerNoop=class ShadowDomManagerNoop{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}};let ShadowDomManager=class ShadowDomManager{constructor(t){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(t,r){if(!isNativeShadowDom(t)||this.shadowDoms.has(t))return;this.shadowDoms.add(t);let n=initMutationObserver(Object.assign(Object.assign({},this.bypassOptions),{doc:r,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t);this.restoreHandlers.push(()=>n.disconnect()),this.restoreHandlers.push(initScrollObserver(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror}))),setTimeout(()=>{t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(t.adoptedStyleSheets,this.mirror.getId(t.host)),this.restoreHandlers.push(initAdoptedStyleSheetObserver({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},t))},0)}observeAttachShadow(t){t.contentWindow&&t.contentDocument&&this.patchAttachShadow(t.contentWindow.Element,t.contentDocument)}patchAttachShadow(t,r){let n=this;this.restoreHandlers.push(patch(t.prototype,"attachShadow",function(t){return function(s){let a=t.call(this,s);return this.shadowRoot&&inDom(this)&&n.addShadowRoot(this.shadowRoot,r),a}}))}reset(){this.restoreHandlers.forEach(t=>{try{t()}catch(t){}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function __rest(t,r){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&0>r.indexOf(s)&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,s=Object.getOwnPropertySymbols(t);a<s.length;a++)0>r.indexOf(s[a])&&Object.prototype.propertyIsEnumerable.call(t,s[a])&&(n[s[a]]=t[s[a]]);return n}function __awaiter(t,r,n,s){function adopt(t){return t instanceof n?t:new n(function(r){r(t)})}return new(n||(n=Promise))(function(n,a){function fulfilled(t){try{step(s.next(t))}catch(t){a(t)}}function rejected(t){try{step(s.throw(t))}catch(t){a(t)}}function step(t){t.done?n(t.value):adopt(t.value).then(fulfilled,rejected)}step((s=s.apply(t,r||[])).next())})}for(var eo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",el="undefined"==typeof Uint8Array?[]:new Uint8Array(256),ed=0;ed<eo.length;ed++)el[eo.charCodeAt(ed)]=ed;var encode=function(t){var r,n=new Uint8Array(t),s=n.length,a="";for(r=0;r<s;r+=3)a+=eo[n[r]>>2]+eo[(3&n[r])<<4|n[r+1]>>4]+eo[(15&n[r+1])<<2|n[r+2]>>6]+eo[63&n[r+2]];return s%3==2?a=a.substring(0,a.length-1)+"=":s%3==1&&(a=a.substring(0,a.length-2)+"=="),a};let ec=new Map;function variableListFor(t,r){let n=ec.get(t);return n||(n=new Map,ec.set(t,n)),n.has(r)||n.set(r,[]),n.get(r)}let saveWebGLVar=(t,r,n)=>{if(!t||!(isInstanceOfWebGLObject(t,r)||"object"==typeof t))return;let s=t.constructor.name,a=variableListFor(n,s),i=a.indexOf(t);return -1===i&&(i=a.length,a.push(t)),i};function serializeArg(t,r,n){if(t instanceof Array)return t.map(t=>serializeArg(t,r,n));if(null===t);else if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray){let r=t.constructor.name;return{rr_type:r,args:[Object.values(t)]}}else if(t instanceof ArrayBuffer){let r=t.constructor.name,n=encode(t);return{rr_type:r,base64:n}}else if(t instanceof DataView){let s=t.constructor.name;return{rr_type:s,args:[serializeArg(t.buffer,r,n),t.byteOffset,t.byteLength]}}else if(t instanceof HTMLImageElement){let r=t.constructor.name,{src:n}=t;return{rr_type:r,src:n}}else if(t instanceof HTMLCanvasElement){let r=t.toDataURL();return{rr_type:"HTMLImageElement",src:r}}else if(t instanceof ImageData){let s=t.constructor.name;return{rr_type:s,args:[serializeArg(t.data,r,n),t.width,t.height]}}else if(isInstanceOfWebGLObject(t,r)||"object"==typeof t){let s=t.constructor.name,a=saveWebGLVar(t,r,n);return{rr_type:s,index:a}}return t}let serializeArgs=(t,r,n)=>[...t].map(t=>serializeArg(t,r,n)),isInstanceOfWebGLObject=(t,r)=>{let n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(t=>"function"==typeof r[t]);return!!n.find(n=>t instanceof r[n])};function initCanvas2DMutationObserver(t,r,n,s,a){let i=[],o=Object.getOwnPropertyNames(r.CanvasRenderingContext2D.prototype);for(let l of o)try{if("function"!=typeof r.CanvasRenderingContext2D.prototype[l])continue;let o=patch(r.CanvasRenderingContext2D.prototype,l,function(i){return function(...o){return isBlocked(this.canvas,n,s,a,!0)||setTimeout(()=>{let n=serializeArgs([...o],r,this);t(this.canvas,{type:en["2D"],property:l,args:n})},0),i.apply(this,o)}});i.push(o)}catch(s){let n=hookSetter(r.CanvasRenderingContext2D.prototype,l,{set(r){t(this.canvas,{type:en["2D"],property:l,args:[r],setter:!0})}});i.push(n)}return()=>{i.forEach(t=>t())}}function getNormalizedContextName(t){return"experimental-webgl"===t?"webgl":t}function initCanvasContextObserver(t,r,n,s,a){let i=[];try{let o=patch(t.HTMLCanvasElement.prototype,"getContext",function(t){return function(i,...o){if(!isBlocked(this,r,n,s,!0)){let t=getNormalizedContextName(i);if("__context"in this||(this.__context=t),a&&["webgl","webgl2"].includes(t)){if(o[0]&&"object"==typeof o[0]){let t=o[0];t.preserveDrawingBuffer||(t.preserveDrawingBuffer=!0)}else o.splice(0,1,{preserveDrawingBuffer:!0})}}return t.apply(this,[i,...o])}});i.push(o)}catch(t){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{i.forEach(t=>t())}}function patchGLPrototype(t,r,n,s,a,i,o,l){let d=[],c=Object.getOwnPropertyNames(t);for(let o of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(o))try{if("function"!=typeof t[o])continue;let c=patch(t,o,function(t){return function(...d){let c=t.apply(this,d);if(saveWebGLVar(c,l,this),"tagName"in this.canvas&&!isBlocked(this.canvas,s,a,i,!0)){let t=serializeArgs([...d],l,this),s={type:r,property:o,args:t};n(this.canvas,s)}return c}});d.push(c)}catch(a){let s=hookSetter(t,o,{set(t){n(this.canvas,{type:r,property:o,args:[t],setter:!0})}});d.push(s)}return d}function initCanvasWebGLMutationObserver(t,r,n,s,a,i){let o=[];return o.push(...patchGLPrototype(r.WebGLRenderingContext.prototype,en.WebGL,t,n,s,a,i,r)),void 0!==r.WebGL2RenderingContext&&o.push(...patchGLPrototype(r.WebGL2RenderingContext.prototype,en.WebGL2,t,n,s,a,i,r)),()=>{o.forEach(t=>t())}}function decodeBase64(t,r){var n=atob(t);if(r){for(var s=new Uint8Array(n.length),a=0,i=n.length;a<i;++a)s[a]=n.charCodeAt(a);return String.fromCharCode.apply(null,new Uint16Array(s.buffer))}return n}function createURL(t,r,n){var s=void 0===r?null:r,a=decodeBase64(t,void 0!==n&&n),i=a.indexOf("\n",10)+1,o=a.substring(i)+(s?"//# sourceMappingURL="+s:""),l=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(l)}var WorkerFactory=function(t){return u=u||createURL("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=",null,!1),new Worker(u,t)};let CanvasManagerNoop=class CanvasManagerNoop{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}};let CanvasManager=class CanvasManager{reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(t,r)=>{let n=this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId;(n||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(t)||this.pendingCanvasMutations.set(t,[]),this.pendingCanvasMutations.get(t).push(r)};let{sampling:r="all",win:n,blockClass:s,blockSelector:a,unblockSelector:i,recordCanvas:o,dataURLOptions:l}=t;this.mutationCb=t.mutationCb,this.mirror=t.mirror,o&&"all"===r&&this.initCanvasMutationObserver(n,s,a,i),o&&"number"==typeof r&&this.initCanvasFPSObserver(r,n,s,a,i,{dataURLOptions:l})}initCanvasFPSObserver(t,r,n,s,a,i){let o;let l=initCanvasContextObserver(r,n,s,a,!0),d=new Map,c=new WorkerFactory;c.onmessage=t=>{let{id:r}=t.data;if(d.set(r,!1),!("base64"in t.data))return;let{base64:n,type:s,width:a,height:i}=t.data;this.mutationCb({id:r,type:en["2D"],commands:[{property:"clearRect",args:[0,0,a,i]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:n}],type:s}]},0,0]}]})};let u=1e3/t,h=0,getCanvas=()=>{let t=[];return r.document.querySelectorAll("canvas").forEach(r=>{isBlocked(r,n,s,a,!0)||t.push(r)}),t},takeCanvasSnapshots=t=>{if(h&&t-h<u){o=requestAnimationFrame(takeCanvasSnapshots);return}h=t,getCanvas().forEach(t=>__awaiter(this,void 0,void 0,function*(){var r;let n=this.mirror.getId(t);if(d.get(n))return;if(d.set(n,!0),["webgl","webgl2"].includes(t.__context)){let n=t.getContext(t.__context);(null===(r=null==n?void 0:n.getContextAttributes())||void 0===r?void 0:r.preserveDrawingBuffer)===!1&&n.clear(n.COLOR_BUFFER_BIT)}let s=yield createImageBitmap(t);c.postMessage({id:n,bitmap:s,width:t.width,height:t.height,dataURLOptions:i.dataURLOptions},[s])})),o=requestAnimationFrame(takeCanvasSnapshots)};o=requestAnimationFrame(takeCanvasSnapshots),this.resetObservers=()=>{l(),cancelAnimationFrame(o)}}initCanvasMutationObserver(t,r,n,s){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();let a=initCanvasContextObserver(t,r,n,s,!1),i=initCanvas2DMutationObserver(this.processMutation.bind(this),t,r,n,s),o=initCanvasWebGLMutationObserver(this.processMutation.bind(this),t,r,n,s,this.mirror);this.resetObservers=()=>{a(),i(),o()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){let setLatestRAFTimestamp=t=>{this.rafStamps.latestId=t,requestAnimationFrame(setLatestRAFTimestamp)};requestAnimationFrame(setLatestRAFTimestamp)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((t,r)=>{let n=this.mirror.getId(r);this.flushPendingCanvasMutationFor(r,n)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(t,r){if(this.frozen||this.locked)return;let n=this.pendingCanvasMutations.get(t);if(!n||-1===r)return;let s=n.map(t=>{let r=__rest(t,["type"]);return r}),{type:a}=n[0];this.mutationCb({id:r,type:a,commands:s}),this.pendingCanvasMutations.delete(t)}};let StylesheetManager=class StylesheetManager{constructor(t){this.trackedLinkElements=new WeakSet,this.styleMirror=new StyleSheetMirror,this.mutationCb=t.mutationCb,this.adoptedStyleSheetCb=t.adoptedStyleSheetCb}attachLinkElement(t,r){"_cssText"in r.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:r.id,attributes:r.attributes}]}),this.trackLinkElement(t)}trackLinkElement(t){this.trackedLinkElements.has(t)||(this.trackedLinkElements.add(t),this.trackStylesheetInLinkElement(t))}adoptStyleSheets(t,r){if(0===t.length)return;let n={id:r,styleIds:[]},s=[];for(let r of t){let t;this.styleMirror.has(r)?t=this.styleMirror.getId(r):(t=this.styleMirror.add(r),s.push({styleId:t,rules:Array.from(r.rules||CSSRule,(t,r)=>({rule:stringifyRule(t),index:r}))})),n.styleIds.push(t)}s.length>0&&(n.styles=s),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(t){}};let ProcessedNodeManager=class ProcessedNodeManager{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){requestAnimationFrame(()=>{this.clear(),this.loop&&this.periodicallyClear()})}inOtherBuffer(t,r){let n=this.nodeMap.get(t);return n&&Array.from(n).some(t=>t!==r)}add(t,r){this.nodeMap.set(t,(this.nodeMap.get(t)||new Set).add(r))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}};function wrapEvent(t){return Object.assign(Object.assign({},t),{timestamp:Q()})}let eu=!1,eh=createMirror();function record(t={}){let r;let{emit:n,checkoutEveryNms:s,checkoutEveryNth:a,blockClass:i="rr-block",blockSelector:c=null,unblockSelector:u=null,ignoreClass:h="rr-ignore",ignoreSelector:p=null,maskAllText:g=!1,maskTextClass:m="rr-mask",unmaskTextClass:f=null,maskTextSelector:_=null,unmaskTextSelector:y=null,inlineStylesheet:b=!0,maskAllInputs:I,maskInputOptions:S,slimDOMOptions:C,maskAttributeFn:v,maskInputFn:w,maskTextFn:E,hooks:k,packFn:A,sampling:R={},dataURLOptions:T={},mousemoveWait:x,recordCanvas:M=!1,recordCrossOriginIframes:N=!1,recordAfter:D="DOMContentLoaded"===t.recordAfter?t.recordAfter:"load",userTriggeredOnInput:O=!1,collectFonts:B=!1,inlineImages:L=!1,plugins:F,keepIframeSrcFn:z=()=>!1,ignoreCSSAttributes:U=new Set([]),errorHandler:W,onMutation:G}=t;registerErrorHandler(W);let Z=!N||window.parent===window,P=!1;if(!Z)try{window.parent.document&&(P=!1)}catch(t){P=!0}if(Z&&!n)throw Error("emit function is required");void 0!==x&&void 0===R.mousemove&&(R.mousemove=x),eh.reset();let V=!0===I?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:void 0!==S?S:{},H=!0===C||"all"===C?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===C,headMetaDescKeywords:"all"===C}:C||{};polyfill();let K=0,eventProcessor=t=>{for(let r of F||[])r.eventProcessor&&(t=r.eventProcessor(t));return A&&!P&&(t=A(t)),t};o=(t,i)=>{var o;if((null===(o=es[0])||void 0===o?void 0:o.isFrozen())&&t.type!==$.FullSnapshot&&!(t.type===$.IncrementalSnapshot&&t.data.source===ee.Mutation)&&es.forEach(t=>t.unfreeze()),Z)null==n||n(eventProcessor(t),i);else if(P){let r={type:"rrweb",event:eventProcessor(t),origin:window.location.origin,isCheckout:i};window.parent.postMessage(r,"*")}if(t.type===$.FullSnapshot)r=t,K=0;else if(t.type===$.IncrementalSnapshot){if(t.data.source===ee.Mutation&&t.data.isAttachIframe)return;K++;let n=a&&K>=a,i=s&&t.timestamp-r.timestamp>s;(n||i)&&l(!0)}};let wrappedMutationEmit=t=>{o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.Mutation},t)}))},wrappedScrollEmit=t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.Scroll},t)})),wrappedCanvasMutationEmit=t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.CanvasMutation},t)})),Y=new StylesheetManager({mutationCb:wrappedMutationEmit,adoptedStyleSheetCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.AdoptedStyleSheet},t)}))}),J="boolean"==typeof __RRWEB_EXCLUDE_IFRAME__&&__RRWEB_EXCLUDE_IFRAME__?new IframeManagerNoop:new IframeManager({mirror:eh,mutationCb:wrappedMutationEmit,stylesheetManager:Y,recordCrossOriginIframes:N,wrappedEmit:o});for(let t of F||[])t.getMirror&&t.getMirror({nodeMirror:eh,crossOriginIframeMirror:J.crossOriginIframeMirror,crossOriginIframeStyleMirror:J.crossOriginIframeStyleMirror});let j=new ProcessedNodeManager;d="boolean"==typeof __RRWEB_EXCLUDE_CANVAS__&&__RRWEB_EXCLUDE_CANVAS__?new CanvasManagerNoop:new CanvasManager({recordCanvas:M,mutationCb:wrappedCanvasMutationEmit,win:window,blockClass:i,blockSelector:c,unblockSelector:u,mirror:eh,sampling:R.canvas,dataURLOptions:T});let X="boolean"==typeof __RRWEB_EXCLUDE_SHADOW_DOM__&&__RRWEB_EXCLUDE_SHADOW_DOM__?new ShadowDomManagerNoop:new ShadowDomManager({mutationCb:wrappedMutationEmit,scrollCb:wrappedScrollEmit,bypassOptions:{onMutation:G,blockClass:i,blockSelector:c,unblockSelector:u,maskAllText:g,maskTextClass:m,unmaskTextClass:f,maskTextSelector:_,unmaskTextSelector:y,inlineStylesheet:b,maskInputOptions:V,dataURLOptions:T,maskAttributeFn:v,maskTextFn:E,maskInputFn:w,recordCanvas:M,inlineImages:L,sampling:R,slimDOMOptions:H,iframeManager:J,stylesheetManager:Y,canvasManager:d,keepIframeSrcFn:z,processedNodeManager:j},mirror:eh});l=(t=!1)=>{o(wrapEvent({type:$.Meta,data:{href:window.location.href,width:getWindowWidth(),height:getWindowHeight()}}),t),Y.reset(),X.init(),es.forEach(t=>t.lock());let r=snapshot(document,{mirror:eh,blockClass:i,blockSelector:c,unblockSelector:u,maskAllText:g,maskTextClass:m,unmaskTextClass:f,maskTextSelector:_,unmaskTextSelector:y,inlineStylesheet:b,maskAllInputs:V,maskAttributeFn:v,maskInputFn:w,maskTextFn:E,slimDOM:H,dataURLOptions:T,recordCanvas:M,inlineImages:L,onSerialize:t=>{isSerializedIframe(t,eh)&&J.addIframe(t),isSerializedStylesheet(t,eh)&&Y.trackLinkElement(t),hasShadowRoot(t)&&X.addShadowRoot(t.shadowRoot,document)},onIframeLoad:(t,r)=>{J.attachIframe(t,r),X.observeAttachShadow(t)},onStylesheetLoad:(t,r)=>{Y.attachLinkElement(t,r)},keepIframeSrcFn:z});if(!r)return console.warn("Failed to snapshot the document");o(wrapEvent({type:$.FullSnapshot,data:{node:r,initialOffset:getWindowScroll(window)}}),t),es.forEach(t=>t.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&Y.adoptStyleSheets(document.adoptedStyleSheets,eh.getId(document))};try{let t=[],observe=t=>{var r;return callbackWrapper(initObservers)({onMutation:G,mutationCb:wrappedMutationEmit,mousemoveCb:(t,r)=>o(wrapEvent({type:$.IncrementalSnapshot,data:{source:r,positions:t}})),mouseInteractionCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.MouseInteraction},t)})),scrollCb:wrappedScrollEmit,viewportResizeCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.ViewportResize},t)})),inputCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.Input},t)})),mediaInteractionCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.MediaInteraction},t)})),styleSheetRuleCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.StyleSheetRule},t)})),styleDeclarationCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.StyleDeclaration},t)})),canvasMutationCb:wrappedCanvasMutationEmit,fontCb:t=>o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.Font},t)})),selectionCb:t=>{o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.Selection},t)}))},customElementCb:t=>{o(wrapEvent({type:$.IncrementalSnapshot,data:Object.assign({source:ee.CustomElement},t)}))},blockClass:i,ignoreClass:h,ignoreSelector:p,maskAllText:g,maskTextClass:m,unmaskTextClass:f,maskTextSelector:_,unmaskTextSelector:y,maskInputOptions:V,inlineStylesheet:b,sampling:R,recordCanvas:M,inlineImages:L,userTriggeredOnInput:O,collectFonts:B,doc:t,maskAttributeFn:v,maskInputFn:w,maskTextFn:E,keepIframeSrcFn:z,blockSelector:c,unblockSelector:u,slimDOMOptions:H,dataURLOptions:T,mirror:eh,iframeManager:J,stylesheetManager:Y,shadowDomManager:X,processedNodeManager:j,canvasManager:d,ignoreCSSAttributes:U,plugins:(null===(r=null==F?void 0:F.filter(t=>t.observer))||void 0===r?void 0:r.map(t=>({observer:t.observer,options:t.options,callback:r=>o(wrapEvent({type:$.Plugin,data:{plugin:t.name,payload:r}}))})))||[]},k)};J.addLoadListener(r=>{try{t.push(observe(r.contentDocument))}catch(t){console.warn(t)}});let init=()=>{l(),t.push(observe(document)),eu=!0};return"interactive"===document.readyState||"complete"===document.readyState?init():(t.push(on("DOMContentLoaded",()=>{o(wrapEvent({type:$.DomContentLoaded,data:{}})),"DOMContentLoaded"===D&&init()})),t.push(on("load",()=>{o(wrapEvent({type:$.Load,data:{}})),"load"===D&&init()},window))),()=>{t.forEach(t=>t()),j.destroy(),eu=!1,unregisterErrorHandler()}}catch(t){console.warn(t)}}function timestampToMs(t){return t>9999999999?t:1e3*t}function timestampToS(t){return t>9999999999?t/1e3:t}function addBreadcrumbEvent(t,r){"sentry.transaction"!==r.category&&(["ui.click","ui.input"].includes(r.category)?t.triggerUserActivity():t.checkAndHandleExpiredSession(),t.addUpdate(()=>(t.throttledAddEvent({type:$.Custom,timestamp:1e3*(r.timestamp||0),data:{tag:"breadcrumb",payload:(0,A.Fv)(r,10,1e3)}}),"console"===r.category)))}function getClickTargetNode(t){let r=getTargetNode(t);if(!r||!(r instanceof Element))return r;let n=r.closest("button,a");return n||r}function getTargetNode(t){return isEventWithTarget(t)?t.target:t}function isEventWithTarget(t){return"object"==typeof t&&!!t&&"target"in t}function onWindowOpen(t){return c||(c=[],monkeyPatchWindowOpen()),c.push(t),()=>{let r=c?c.indexOf(t):-1;r>-1&&c.splice(r,1)}}function monkeyPatchWindowOpen(){(0,R.hl)(z,"open",function(t){return function(...r){if(c)try{c.forEach(t=>t())}catch(t){}return t.apply(z,r)}})}function handleClick(t,r,n){t.handleClick(r,n)}record.addCustomEvent=(t,r)=>{if(!eu)throw Error("please add custom event after start recording");o(wrapEvent({type:$.Custom,data:{tag:t,payload:r}}))},record.freezePage=()=>{es.forEach(t=>t.freeze())},record.takeFullSnapshot=t=>{if(!eu)throw Error("please take full snapshot after start recording");l(t)},record.mirror=eh;let ClickDetector=class ClickDetector{constructor(t,r,n=addBreadcrumbEvent){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=r.timeout/1e3,this._threshold=r.threshold/1e3,this._scollTimeout=r.scrollTimeout/1e3,this._replay=t,this._ignoreSelector=r.ignoreSelector,this._addBreadcrumbEvent=n}addListeners(){let scrollHandler=()=>{this._lastScroll=nowInSeconds()},t=onWindowOpen(()=>{this._lastMutation=nowInSeconds()}),clickHandler=t=>{if(!t.target)return;let r=getClickTargetNode(t);r&&this._handleMultiClick(r)},r=new MutationObserver(()=>{this._lastMutation=nowInSeconds()});r.observe(z.document.documentElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),z.addEventListener("scroll",scrollHandler,{passive:!0}),z.addEventListener("click",clickHandler,{passive:!0}),this._teardown=()=>{z.removeEventListener("scroll",scrollHandler),z.removeEventListener("click",clickHandler),t(),r.disconnect(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(t,r){if(ignoreElement(r,this._ignoreSelector)||!isClickBreadcrumb(t))return;let n={timestamp:timestampToS(t.timestamp),clickBreadcrumb:t,clickCount:0,node:r};this._clicks.some(t=>t.node===n.node&&1>Math.abs(t.timestamp-n.timestamp))||(this._clicks.push(n),1===this._clicks.length&&this._scheduleCheckClicks())}_handleMultiClick(t){this._getClicks(t).forEach(t=>{t.clickCount++})}_getClicks(t){return this._clicks.filter(r=>r.node===t)}_checkClicks(){let t=[],r=nowInSeconds();for(let n of(this._clicks.forEach(n=>{!n.mutationAfter&&this._lastMutation&&(n.mutationAfter=n.timestamp<=this._lastMutation?this._lastMutation-n.timestamp:void 0),!n.scrollAfter&&this._lastScroll&&(n.scrollAfter=n.timestamp<=this._lastScroll?this._lastScroll-n.timestamp:void 0),n.timestamp+this._timeout<=r&&t.push(n)}),t)){let t=this._clicks.indexOf(n);t>-1&&(this._generateBreadcrumbs(n),this._clicks.splice(t,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(t){let r=this._replay,n=t.scrollAfter&&t.scrollAfter<=this._scollTimeout,s=t.mutationAfter&&t.mutationAfter<=this._threshold,{clickCount:a,clickBreadcrumb:i}=t;if(!n&&!s){let n=1e3*Math.min(t.mutationAfter||this._timeout,this._timeout),s=n<1e3*this._timeout?"mutation":"timeout",o={type:"default",message:i.message,timestamp:i.timestamp,category:"ui.slowClickDetected",data:{...i.data,url:z.location.href,route:r.getCurrentRoute(),timeAfterClickMs:n,endReason:s,clickCount:a||1}};this._addBreadcrumbEvent(r,o);return}if(a>1){let t={type:"default",message:i.message,timestamp:i.timestamp,category:"ui.multiClick",data:{...i.data,url:z.location.href,route:r.getCurrentRoute(),clickCount:a,metric:!0}};this._addBreadcrumbEvent(r,t)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=setTimeout(()=>this._checkClicks(),1e3)}};let ep=["A","BUTTON","INPUT"];function ignoreElement(t,r){return!!(!ep.includes(t.tagName)||"INPUT"===t.tagName&&!["submit","button"].includes(t.getAttribute("type")||"")||"A"===t.tagName&&(t.hasAttribute("download")||t.hasAttribute("target")&&"_self"!==t.getAttribute("target"))||r&&t.matches(r))}function isClickBreadcrumb(t){return!!(t.data&&"number"==typeof t.data.nodeId&&t.timestamp)}function nowInSeconds(){return Date.now()/1e3}function createBreadcrumb(t){return{timestamp:Date.now()/1e3,type:"default",...t}}(y=I||(I={}))[y.Document=0]="Document",y[y.DocumentType=1]="DocumentType",y[y.Element=2]="Element",y[y.Text=3]="Text",y[y.CDATA=4]="CDATA",y[y.Comment=5]="Comment";let eg=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled"]);function getAttributesToRecord(t){let r={};for(let n in t)if(eg.has(n)){let s=n;("data-testid"===n||"data-test-id"===n)&&(s="testId"),r[s]=t[n]}return r}let handleDomListener=t=>r=>{if(!t.isEnabled())return;let n=handleDom(r);if(!n)return;let s="click"===r.name,a=s&&r.event;!s||!t.clickDetector||!a||a.altKey||a.metaKey||a.ctrlKey||a.shiftKey||handleClick(t.clickDetector,n,getClickTargetNode(r.event)),addBreadcrumbEvent(t,n)};function getBaseDomBreadcrumb(t,r){let n=record.mirror.getId(t),s=n&&record.mirror.getNode(n),a=s&&record.mirror.getMeta(s),i=a&&isElement(a)?a:null;return{message:r,data:i?{nodeId:n,node:{id:n,tagName:i.tagName,textContent:Array.from(i.childNodes).map(t=>t.type===I.Text&&t.textContent).filter(Boolean).map(t=>t.trim()).join(""),attributes:getAttributesToRecord(i.attributes)}}:{}}}function handleDom(t){let{target:r,message:n}=getDomTarget(t);return createBreadcrumb({category:`ui.${t.name}`,...getBaseDomBreadcrumb(r,n)})}function getDomTarget(t){let r;let n="click"===t.name,s=null;try{s=n?getClickTargetNode(t.event):getTargetNode(t.event),r=(0,T.Rt)(s,{maxStringLength:200})||"<unknown>"}catch(t){r="<unknown>"}return{target:s,message:r}}function isElement(t){return t.type===I.Element}function handleKeyboardEvent(t,r){if(!t.isEnabled())return;t.updateUserActivity();let n=getKeyboardBreadcrumb(r);n&&addBreadcrumbEvent(t,n)}function getKeyboardBreadcrumb(t){let{metaKey:r,shiftKey:n,ctrlKey:s,altKey:a,key:i,target:o}=t;if(!o||isInputElement(o)||!i)return null;let l=1===i.length;if(!(r||s||a)&&l)return null;let d=(0,T.Rt)(o,{maxStringLength:200})||"<unknown>",c=getBaseDomBreadcrumb(o,d);return createBreadcrumb({category:"ui.keyDown",message:d,data:{...c.data,metaKey:r,shiftKey:n,ctrlKey:s,altKey:a,key:i}})}function isInputElement(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable}let em={resource:createResourceEntry,paint:createPaintEntry,navigation:createNavigationEntry};function createPerformanceEntries(t){return t.map(createPerformanceEntry).filter(Boolean)}function createPerformanceEntry(t){return em[t.entryType]?em[t.entryType](t):null}function getAbsoluteTime(t){return((x.Z1||z.performance.timeOrigin)+t)/1e3}function createPaintEntry(t){let{duration:r,entryType:n,name:s,startTime:a}=t,i=getAbsoluteTime(a);return{type:n,name:s,start:i,end:i+r,data:void 0}}function createNavigationEntry(t){let{entryType:r,name:n,decodedBodySize:s,duration:a,domComplete:i,encodedBodySize:o,domContentLoadedEventStart:l,domContentLoadedEventEnd:d,domInteractive:c,loadEventStart:u,loadEventEnd:h,redirectCount:p,startTime:g,transferSize:m,type:f}=t;return 0===a?null:{type:`${r}.${f}`,start:getAbsoluteTime(g),end:getAbsoluteTime(i),name:n,data:{size:m,decodedBodySize:s,encodedBodySize:o,duration:a,domInteractive:c,domContentLoadedEventStart:l,domContentLoadedEventEnd:d,loadEventStart:u,loadEventEnd:h,domComplete:i,redirectCount:p}}}function createResourceEntry(t){let{entryType:r,initiatorType:n,name:s,responseEnd:a,startTime:i,decodedBodySize:o,encodedBodySize:l,responseStatus:d,transferSize:c}=t;return["fetch","xmlhttprequest"].includes(n)?null:{type:`${r}.${n}`,start:getAbsoluteTime(i),end:getAbsoluteTime(a),name:s,data:{size:c,statusCode:d,decodedBodySize:o,encodedBodySize:l}}}function getLargestContentfulPaint(t){let r=t.entries,n=r[r.length-1],s=n?n.element:void 0,a=t.value,i=getAbsoluteTime(a),o={type:"largest-contentful-paint",name:"largest-contentful-paint",start:i,end:i,data:{value:a,size:a,nodeId:s?record.mirror.getId(s):void 0}};return o}function setupPerformanceObserver(t){function addPerformanceEntry(r){t.performanceEntries.includes(r)||t.performanceEntries.push(r)}function onEntries({entries:t}){t.forEach(addPerformanceEntry)}let r=[];return["navigation","paint","resource"].forEach(t=>{r.push((0,F._j)(t,onEntries))}),r.push((0,F.$A)(({metric:r})=>{t.replayPerformanceEntries.push(getLargestContentfulPaint(r))})),()=>{r.forEach(t=>t())}}function e(){let t=new Blob(['var t={},e={};function a(t){let e=t.length;for(;--e>=0;)t[e]=0}const s=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),r=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),i=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_=new Array(576);a(_);const l=new Array(60);a(l);const h=new Array(512);a(h);const o=new Array(256);a(o);const d=new Array(29);a(d);const u=new Array(30);function f(t,e,a,s,r){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=s,this.max_length=r,this.has_stree=t&&t.length}let c,p,g;function w(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}a(u);const m=t=>t<256?h[t]:h[256+(t>>>7)],b=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},y=(t,e,a)=>{t.bi_valid>16-a?(t.bi_buf|=e<<t.bi_valid&65535,b(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=a-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)},v=(t,e,a)=>{y(t,a[2*e],a[2*e+1])},z=(t,e)=>{let a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1},k=(t,e,a)=>{const s=new Array(16);let r,n,i=0;for(r=1;r<=15;r++)i=i+a[r-1]<<1,s[r]=i;for(n=0;n<=e;n++){let e=t[2*n+1];0!==e&&(t[2*n]=z(s[e]++,e))}},x=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},A=t=>{t.bi_valid>8?b(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},E=(t,e,a,s)=>{const r=2*e,n=2*a;return t[r]<t[n]||t[r]===t[n]&&s[e]<=s[a]},Z=(t,e,a)=>{const s=t.heap[a];let r=a<<1;for(;r<=t.heap_len&&(r<t.heap_len&&E(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!E(e,s,t.heap[r],t.depth));)t.heap[a]=t.heap[r],a=r,r<<=1;t.heap[a]=s},S=(t,e,a)=>{let n,i,_,l,h=0;if(0!==t.sym_next)do{n=255&t.pending_buf[t.sym_buf+h++],n+=(255&t.pending_buf[t.sym_buf+h++])<<8,i=t.pending_buf[t.sym_buf+h++],0===n?v(t,i,e):(_=o[i],v(t,_+256+1,e),l=s[_],0!==l&&(i-=d[_],y(t,i,l)),n--,_=m(n),v(t,_,a),l=r[_],0!==l&&(n-=u[_],y(t,n,l)))}while(h<t.sym_next);v(t,256,e)},U=(t,e)=>{const a=e.dyn_tree,s=e.stat_desc.static_tree,r=e.stat_desc.has_stree,n=e.stat_desc.elems;let i,_,l,h=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<n;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=h<2?++h:0,a[2*l]=1,t.depth[l]=0,t.opt_len--,r&&(t.static_len-=s[2*l+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)Z(t,a,i);l=n;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Z(t,a,1),_=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=_,a[2*l]=a[2*i]+a[2*_],t.depth[l]=(t.depth[i]>=t.depth[_]?t.depth[i]:t.depth[_])+1,a[2*i+1]=a[2*_+1]=l,t.heap[1]=l++,Z(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const a=e.dyn_tree,s=e.max_code,r=e.stat_desc.static_tree,n=e.stat_desc.has_stree,i=e.stat_desc.extra_bits,_=e.stat_desc.extra_base,l=e.stat_desc.max_length;let h,o,d,u,f,c,p=0;for(u=0;u<=15;u++)t.bl_count[u]=0;for(a[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<573;h++)o=t.heap[h],u=a[2*a[2*o+1]+1]+1,u>l&&(u=l,p++),a[2*o+1]=u,o>s||(t.bl_count[u]++,f=0,o>=_&&(f=i[o-_]),c=a[2*o],t.opt_len+=c*(u+f),n&&(t.static_len+=c*(r[2*o+1]+f)));if(0!==p){do{for(u=l-1;0===t.bl_count[u];)u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[l]--,p-=2}while(p>0);for(u=l;0!==u;u--)for(o=t.bl_count[u];0!==o;)d=t.heap[--h],d>s||(a[2*d+1]!==u&&(t.opt_len+=(u-a[2*d+1])*a[2*d],a[2*d+1]=u),o--)}})(t,e),k(a,h,t.bl_count)},R=(t,e,a)=>{let s,r,n=-1,i=e[1],_=0,l=7,h=4;for(0===i&&(l=138,h=3),e[2*(a+1)+1]=65535,s=0;s<=a;s++)r=i,i=e[2*(s+1)+1],++_<l&&r===i||(_<h?t.bl_tree[2*r]+=_:0!==r?(r!==n&&t.bl_tree[2*r]++,t.bl_tree[32]++):_<=10?t.bl_tree[34]++:t.bl_tree[36]++,_=0,n=r,0===i?(l=138,h=3):r===i?(l=6,h=3):(l=7,h=4))},L=(t,e,a)=>{let s,r,n=-1,i=e[1],_=0,l=7,h=4;for(0===i&&(l=138,h=3),s=0;s<=a;s++)if(r=i,i=e[2*(s+1)+1],!(++_<l&&r===i)){if(_<h)do{v(t,r,t.bl_tree)}while(0!=--_);else 0!==r?(r!==n&&(v(t,r,t.bl_tree),_--),v(t,16,t.bl_tree),y(t,_-3,2)):_<=10?(v(t,17,t.bl_tree),y(t,_-3,3)):(v(t,18,t.bl_tree),y(t,_-11,7));_=0,n=r,0===i?(l=138,h=3):r===i?(l=6,h=3):(l=7,h=4)}};let T=!1;const F=(t,e,a,s)=>{y(t,0+(s?1:0),3),A(t),b(t,a),b(t,~a),a&&t.pending_buf.set(t.window.subarray(e,e+a),t.pending),t.pending+=a};e._tr_init=t=>{T||((()=>{let t,e,a,i,w;const m=new Array(16);for(a=0,i=0;i<28;i++)for(d[i]=a,t=0;t<1<<s[i];t++)o[a++]=i;for(o[a-1]=i,w=0,i=0;i<16;i++)for(u[i]=w,t=0;t<1<<r[i];t++)h[w++]=i;for(w>>=7;i<30;i++)for(u[i]=w<<7,t=0;t<1<<r[i]-7;t++)h[256+w++]=i;for(e=0;e<=15;e++)m[e]=0;for(t=0;t<=143;)_[2*t+1]=8,t++,m[8]++;for(;t<=255;)_[2*t+1]=9,t++,m[9]++;for(;t<=279;)_[2*t+1]=7,t++,m[7]++;for(;t<=287;)_[2*t+1]=8,t++,m[8]++;for(k(_,287,m),t=0;t<30;t++)l[2*t+1]=5,l[2*t]=z(t,5);c=new f(_,s,257,286,15),p=new f(l,r,0,30,15),g=new f(new Array(0),n,0,19,7)})(),T=!0),t.l_desc=new w(t.dyn_ltree,c),t.d_desc=new w(t.dyn_dtree,p),t.bl_desc=new w(t.bl_tree,g),t.bi_buf=0,t.bi_valid=0,x(t)},e._tr_stored_block=F,e._tr_flush_block=(t,e,a,s)=>{let r,n,h=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),U(t,t.l_desc),U(t,t.d_desc),h=(t=>{let e;for(R(t,t.dyn_ltree,t.l_desc.max_code),R(t,t.dyn_dtree,t.d_desc.max_code),U(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*i[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,n=t.static_len+3+7>>>3,n<=r&&(r=n)):r=n=a+5,a+4<=r&&-1!==e?F(t,e,a,s):4===t.strategy||n===r?(y(t,2+(s?1:0),3),S(t,_,l)):(y(t,4+(s?1:0),3),((t,e,a,s)=>{let r;for(y(t,e-257,5),y(t,a-1,5),y(t,s-4,4),r=0;r<s;r++)y(t,t.bl_tree[2*i[r]+1],3);L(t,t.dyn_ltree,e-1),L(t,t.dyn_dtree,a-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),S(t,t.dyn_ltree,t.dyn_dtree)),x(t),s&&A(t)},e._tr_tally=(t,e,a)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=a,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(o[a]+256+1)]++,t.dyn_dtree[2*m(e)]++),t.sym_next===t.sym_end),e._tr_align=t=>{y(t,2,3),v(t,256,_),(t=>{16===t.bi_valid?(b(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)};var O=(t,e,a,s)=>{let r=65535&t|0,n=t>>>16&65535|0,i=0;for(;0!==a;){i=a>2e3?2e3:a,a-=i;do{r=r+e[s++]|0,n=n+r|0}while(--i);r%=65521,n%=65521}return r|n<<16|0};const D=new Uint32Array((()=>{let t,e=[];for(var a=0;a<256;a++){t=a;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e})());var N=(t,e,a,s)=>{const r=D,n=s+a;t^=-1;for(let a=s;a<n;a++)t=t>>>8^r[255&(t^e[a])];return-1^t},C={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},I={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:H,_tr_stored_block:B,_tr_flush_block:M,_tr_tally:P,_tr_align:Y}=e,K=O,j=N,G=C,{Z_NO_FLUSH:X,Z_PARTIAL_FLUSH:W,Z_FULL_FLUSH:q,Z_FINISH:J,Z_BLOCK:Q,Z_OK:V,Z_STREAM_END:$,Z_STREAM_ERROR:tt,Z_DATA_ERROR:et,Z_BUF_ERROR:at,Z_DEFAULT_COMPRESSION:st,Z_FILTERED:rt,Z_HUFFMAN_ONLY:nt,Z_RLE:it,Z_FIXED:_t,Z_DEFAULT_STRATEGY:lt,Z_UNKNOWN:ht,Z_DEFLATED:ot}=I,dt=(t,e)=>(t.msg=G[e],e),ut=t=>2*t-(t>4?9:0),ft=t=>{let e=t.length;for(;--e>=0;)t[e]=0},ct=t=>{let e,a,s,r=t.w_size;e=t.hash_size,s=e;do{a=t.head[--s],t.head[s]=a>=r?a-r:0}while(--e);e=r,s=e;do{a=t.prev[--s],t.prev[s]=a>=r?a-r:0}while(--e)};let pt=(t,e,a)=>(e<<t.hash_shift^a)&t.hash_mask;const gt=t=>{const e=t.state;let a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},wt=(t,e)=>{M(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,gt(t.strm)},mt=(t,e)=>{t.pending_buf[t.pending++]=e},bt=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},yt=(t,e,a,s)=>{let r=t.avail_in;return r>s&&(r=s),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),a),1===t.state.wrap?t.adler=K(t.adler,e,r,a):2===t.state.wrap&&(t.adler=j(t.adler,e,r,a)),t.next_in+=r,t.total_in+=r,r)},vt=(t,e)=>{let a,s,r=t.max_chain_length,n=t.strstart,i=t.prev_length,_=t.nice_match;const l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,h=t.window,o=t.w_mask,d=t.prev,u=t.strstart+258;let f=h[n+i-1],c=h[n+i];t.prev_length>=t.good_match&&(r>>=2),_>t.lookahead&&(_=t.lookahead);do{if(a=e,h[a+i]===c&&h[a+i-1]===f&&h[a]===h[n]&&h[++a]===h[n+1]){n+=2,a++;do{}while(h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&h[++n]===h[++a]&&n<u);if(s=258-(u-n),n=u-258,s>i){if(t.match_start=e,i=s,s>=_)break;f=h[n+i-1],c=h[n+i]}}}while((e=d[e&o])>l&&0!=--r);return i<=t.lookahead?i:t.lookahead},zt=t=>{const e=t.w_size;let a,s,r;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-262)&&(t.window.set(t.window.subarray(e,e+e-s),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),ct(t),s+=e),0===t.strm.avail_in)break;if(a=yt(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=a,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=pt(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=pt(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)},kt=(t,e)=>{let a,s,r,n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,i=0,_=t.strm.avail_in;do{if(a=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r)break;if(r=t.strm.avail_out-r,s=t.strstart-t.block_start,a>s+t.strm.avail_in&&(a=s+t.strm.avail_in),a>r&&(a=r),a<n&&(0===a&&e!==J||e===X||a!==s+t.strm.avail_in))break;i=e===J&&a===s+t.strm.avail_in?1:0,B(t,0,0,i),t.pending_buf[t.pending-4]=a,t.pending_buf[t.pending-3]=a>>8,t.pending_buf[t.pending-2]=~a,t.pending_buf[t.pending-1]=~a>>8,gt(t.strm),s&&(s>a&&(s=a),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,a-=s),a&&(yt(t.strm,t.strm.output,t.strm.next_out,a),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a)}while(0===i);return _-=t.strm.avail_in,_&&(_>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=_&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-_,t.strm.next_in),t.strstart),t.strstart+=_,t.insert+=_>t.w_size-t.insert?t.w_size-t.insert:_),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),i?4:e!==X&&e!==J&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(yt(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,n=r>t.w_size?t.w_size:r,s=t.strstart-t.block_start,(s>=n||(s||e===J)&&e!==X&&0===t.strm.avail_in&&s<=r)&&(a=s>r?r:s,i=e===J&&0===t.strm.avail_in&&a===s?1:0,B(t,t.block_start,a,i),t.block_start+=a,gt(t.strm)),i?3:1)},xt=(t,e)=>{let a,s;for(;;){if(t.lookahead<262){if(zt(t),t.lookahead<262&&e===X)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=pt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-262&&(t.match_length=vt(t,a)),t.match_length>=3)if(s=P(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=pt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=pt(t,t.ins_h,t.window[t.strstart+1]);else s=P(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(wt(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===J?(wt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(wt(t,!1),0===t.strm.avail_out)?1:2},At=(t,e)=>{let a,s,r;for(;;){if(t.lookahead<262){if(zt(t),t.lookahead<262&&e===X)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=pt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-262&&(t.match_length=vt(t,a),t.match_length<=5&&(t.strategy===rt||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,s=P(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=pt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(wt(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(s=P(t,0,t.window[t.strstart-1]),s&&wt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=P(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===J?(wt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(wt(t,!1),0===t.strm.avail_out)?1:2};function Et(t,e,a,s,r){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=s,this.func=r}const Zt=[new Et(0,0,0,0,kt),new Et(4,4,8,4,xt),new Et(4,5,16,8,xt),new Et(4,6,32,32,xt),new Et(4,4,16,16,At),new Et(8,16,32,32,At),new Et(8,16,128,128,At),new Et(8,32,128,256,At),new Et(32,128,258,1024,At),new Et(32,258,258,4096,At)];function St(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ot,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ft(this.dyn_ltree),ft(this.dyn_dtree),ft(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ft(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ft(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ut=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||42!==e.status&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&113!==e.status&&666!==e.status?1:0},Rt=t=>{if(Ut(t))return dt(t,tt);t.total_in=t.total_out=0,t.data_type=ht;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=-2,H(e),V},Lt=t=>{const e=Rt(t);var a;return e===V&&((a=t.state).window_size=2*a.w_size,ft(a.head),a.max_lazy_match=Zt[a.level].max_lazy,a.good_match=Zt[a.level].good_length,a.nice_match=Zt[a.level].nice_length,a.max_chain_length=Zt[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),e},Tt=(t,e,a,s,r,n)=>{if(!t)return tt;let i=1;if(e===st&&(e=6),s<0?(i=0,s=-s):s>15&&(i=2,s-=16),r<1||r>9||a!==ot||s<8||s>15||e<0||e>9||n<0||n>_t||8===s&&1!==i)return dt(t,tt);8===s&&(s=9);const _=new St;return t.state=_,_.strm=t,_.status=42,_.wrap=i,_.gzhead=null,_.w_bits=s,_.w_size=1<<_.w_bits,_.w_mask=_.w_size-1,_.hash_bits=r+7,_.hash_size=1<<_.hash_bits,_.hash_mask=_.hash_size-1,_.hash_shift=~~((_.hash_bits+3-1)/3),_.window=new Uint8Array(2*_.w_size),_.head=new Uint16Array(_.hash_size),_.prev=new Uint16Array(_.w_size),_.lit_bufsize=1<<r+6,_.pending_buf_size=4*_.lit_bufsize,_.pending_buf=new Uint8Array(_.pending_buf_size),_.sym_buf=_.lit_bufsize,_.sym_end=3*(_.lit_bufsize-1),_.level=e,_.strategy=n,_.method=a,Lt(t)};t.deflateInit=(t,e)=>Tt(t,e,ot,15,8,lt),t.deflateInit2=Tt,t.deflateReset=Lt,t.deflateResetKeep=Rt,t.deflateSetHeader=(t,e)=>Ut(t)||2!==t.state.wrap?tt:(t.state.gzhead=e,V),t.deflate=(t,e)=>{if(Ut(t)||e>Q||e<0)return t?dt(t,tt):tt;const a=t.state;if(!t.output||0!==t.avail_in&&!t.input||666===a.status&&e!==J)return dt(t,0===t.avail_out?at:tt);const s=a.last_flush;if(a.last_flush=e,0!==a.pending){if(gt(t),0===t.avail_out)return a.last_flush=-1,V}else if(0===t.avail_in&&ut(e)<=ut(s)&&e!==J)return dt(t,at);if(666===a.status&&0!==t.avail_in)return dt(t,at);if(42===a.status&&0===a.wrap&&(a.status=113),42===a.status){let e=ot+(a.w_bits-8<<4)<<8,s=-1;if(s=a.strategy>=nt||a.level<2?0:a.level<6?1:6===a.level?2:3,e|=s<<6,0!==a.strstart&&(e|=32),e+=31-e%31,bt(a,e),0!==a.strstart&&(bt(a,t.adler>>>16),bt(a,65535&t.adler)),t.adler=1,a.status=113,gt(t),0!==a.pending)return a.last_flush=-1,V}if(57===a.status)if(t.adler=0,mt(a,31),mt(a,139),mt(a,8),a.gzhead)mt(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),mt(a,255&a.gzhead.time),mt(a,a.gzhead.time>>8&255),mt(a,a.gzhead.time>>16&255),mt(a,a.gzhead.time>>24&255),mt(a,9===a.level?2:a.strategy>=nt||a.level<2?4:0),mt(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(mt(a,255&a.gzhead.extra.length),mt(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=j(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(mt(a,0),mt(a,0),mt(a,0),mt(a,0),mt(a,0),mt(a,9===a.level?2:a.strategy>=nt||a.level<2?4:0),mt(a,3),a.status=113,gt(t),0!==a.pending)return a.last_flush=-1,V;if(69===a.status){if(a.gzhead.extra){let e=a.pending,s=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+s>a.pending_buf_size;){let r=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+r),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>e&&(t.adler=j(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex+=r,gt(t),0!==a.pending)return a.last_flush=-1,V;e=0,s-=r}let r=new Uint8Array(a.gzhead.extra);a.pending_buf.set(r.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending+=s,a.gzhead.hcrc&&a.pending>e&&(t.adler=j(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let e,s=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>s&&(t.adler=j(t.adler,a.pending_buf,a.pending-s,s)),gt(t),0!==a.pending)return a.last_flush=-1,V;s=0}e=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,mt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>s&&(t.adler=j(t.adler,a.pending_buf,a.pending-s,s)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let e,s=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>s&&(t.adler=j(t.adler,a.pending_buf,a.pending-s,s)),gt(t),0!==a.pending)return a.last_flush=-1,V;s=0}e=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,mt(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>s&&(t.adler=j(t.adler,a.pending_buf,a.pending-s,s))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(gt(t),0!==a.pending))return a.last_flush=-1,V;mt(a,255&t.adler),mt(a,t.adler>>8&255),t.adler=0}if(a.status=113,gt(t),0!==a.pending)return a.last_flush=-1,V}if(0!==t.avail_in||0!==a.lookahead||e!==X&&666!==a.status){let s=0===a.level?kt(a,e):a.strategy===nt?((t,e)=>{let a;for(;;){if(0===t.lookahead&&(zt(t),0===t.lookahead)){if(e===X)return 1;break}if(t.match_length=0,a=P(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(wt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===J?(wt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(wt(t,!1),0===t.strm.avail_out)?1:2})(a,e):a.strategy===it?((t,e)=>{let a,s,r,n;const i=t.window;for(;;){if(t.lookahead<=258){if(zt(t),t.lookahead<=258&&e===X)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,s=i[r],s===i[++r]&&s===i[++r]&&s===i[++r])){n=t.strstart+258;do{}while(s===i[++r]&&s===i[++r]&&s===i[++r]&&s===i[++r]&&s===i[++r]&&s===i[++r]&&s===i[++r]&&s===i[++r]&&r<n);t.match_length=258-(n-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=P(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=P(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(wt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===J?(wt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(wt(t,!1),0===t.strm.avail_out)?1:2})(a,e):Zt[a.level].func(a,e);if(3!==s&&4!==s||(a.status=666),1===s||3===s)return 0===t.avail_out&&(a.last_flush=-1),V;if(2===s&&(e===W?Y(a):e!==Q&&(B(a,0,0,!1),e===q&&(ft(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),gt(t),0===t.avail_out))return a.last_flush=-1,V}return e!==J?V:a.wrap<=0?$:(2===a.wrap?(mt(a,255&t.adler),mt(a,t.adler>>8&255),mt(a,t.adler>>16&255),mt(a,t.adler>>24&255),mt(a,255&t.total_in),mt(a,t.total_in>>8&255),mt(a,t.total_in>>16&255),mt(a,t.total_in>>24&255)):(bt(a,t.adler>>>16),bt(a,65535&t.adler)),gt(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?V:$)},t.deflateEnd=t=>{if(Ut(t))return tt;const e=t.state.status;return t.state=null,113===e?dt(t,et):V},t.deflateSetDictionary=(t,e)=>{let a=e.length;if(Ut(t))return tt;const s=t.state,r=s.wrap;if(2===r||1===r&&42!==s.status||s.lookahead)return tt;if(1===r&&(t.adler=K(t.adler,e,a,0)),s.wrap=0,a>=s.w_size){0===r&&(ft(s.head),s.strstart=0,s.block_start=0,s.insert=0);let t=new Uint8Array(s.w_size);t.set(e.subarray(a-s.w_size,a),0),e=t,a=s.w_size}const n=t.avail_in,i=t.next_in,_=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,zt(s);s.lookahead>=3;){let t=s.strstart,e=s.lookahead-2;do{s.ins_h=pt(s,s.ins_h,s.window[t+3-1]),s.prev[t&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=t,t++}while(--e);s.strstart=t,s.lookahead=2,zt(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=i,t.input=_,t.avail_in=n,s.wrap=r,V},t.deflateInfo="pako deflate (from Nodeca project)";var Ft={};const Ot=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);Ft.assign=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const a=e.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const e in a)Ot(a,e)&&(t[e]=a[e])}}return t},Ft.flattenChunks=t=>{let e=0;for(let a=0,s=t.length;a<s;a++)e+=t[a].length;const a=new Uint8Array(e);for(let e=0,s=0,r=t.length;e<r;e++){let r=t[e];a.set(r,s),s+=r.length}return a};var Dt={};let Nt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Nt=!1}const Ct=new Uint8Array(256);for(let t=0;t<256;t++)Ct[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ct[254]=Ct[254]=1,Dt.string2buf=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,a,s,r,n,i=t.length,_=0;for(r=0;r<i;r++)a=t.charCodeAt(r),55296==(64512&a)&&r+1<i&&(s=t.charCodeAt(r+1),56320==(64512&s)&&(a=65536+(a-55296<<10)+(s-56320),r++)),_+=a<128?1:a<2048?2:a<65536?3:4;for(e=new Uint8Array(_),n=0,r=0;n<_;r++)a=t.charCodeAt(r),55296==(64512&a)&&r+1<i&&(s=t.charCodeAt(r+1),56320==(64512&s)&&(a=65536+(a-55296<<10)+(s-56320),r++)),a<128?e[n++]=a:a<2048?(e[n++]=192|a>>>6,e[n++]=128|63&a):a<65536?(e[n++]=224|a>>>12,e[n++]=128|a>>>6&63,e[n++]=128|63&a):(e[n++]=240|a>>>18,e[n++]=128|a>>>12&63,e[n++]=128|a>>>6&63,e[n++]=128|63&a);return e};Dt.buf2string=(t,e)=>{const a=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let s,r;const n=new Array(2*a);for(r=0,s=0;s<a;){let e=t[s++];if(e<128){n[r++]=e;continue}let i=Ct[e];if(i>4)n[r++]=65533,s+=i-1;else{for(e&=2===i?31:3===i?15:7;i>1&&s<a;)e=e<<6|63&t[s++],i--;i>1?n[r++]=65533:e<65536?n[r++]=e:(e-=65536,n[r++]=55296|e>>10&1023,n[r++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Nt)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let a="";for(let s=0;s<e;s++)a+=String.fromCharCode(t[s]);return a})(n,r)},Dt.utf8border=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let a=e-1;for(;a>=0&&128==(192&t[a]);)a--;return a<0||0===a?e:a+Ct[t[a]]>e?a:e};const It=t,Ht=Ft,Bt=Dt,Mt=C,Pt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Yt=Object.prototype.toString,{Z_NO_FLUSH:Kt,Z_SYNC_FLUSH:jt,Z_FULL_FLUSH:Gt,Z_FINISH:Xt,Z_OK:Wt,Z_STREAM_END:qt,Z_DEFAULT_COMPRESSION:Jt,Z_DEFAULT_STRATEGY:Qt,Z_DEFLATED:Vt}=I;function $t(t){this.options=Ht.assign({level:Jt,method:Vt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Qt},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Pt,this.strm.avail_out=0;let a=It.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==Wt)throw new Error(Mt[a]);if(e.header&&It.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Bt.string2buf(e.dictionary):"[object ArrayBuffer]"===Yt.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,a=It.deflateSetDictionary(this.strm,t),a!==Wt)throw new Error(Mt[a]);this._dict_set=!0}}$t.prototype.push=function(t,e){const a=this.strm,s=this.options.chunkSize;let r,n;if(this.ended)return!1;for(n=e===~~e?e:!0===e?Xt:Kt,"string"==typeof t?a.input=Bt.string2buf(t):"[object ArrayBuffer]"===Yt.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(s),a.next_out=0,a.avail_out=s),(n===jt||n===Gt)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(r=It.deflate(a,n),r===qt)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),r=It.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Wt;if(0!==a.avail_out){if(n>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},$t.prototype.onData=function(t){this.chunks.push(t)},$t.prototype.onEnd=function(t){t===Wt&&(this.result=Ht.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const te=$t,ee=function(t,e){const a=new $t(e);if(a.push(t,!0),a.err)throw a.msg||Mt[a.err];return a.result},ae=I;const se=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const e=this._hasEvents?",":"";this.deflate.push(e+t,ae.Z_SYNC_FLUSH),this._hasEvents=!0}finish(){if(this.deflate.push("]",ae.Z_FINISH),this.deflate.err)throw this.deflate.err;const t=this.deflate.result;return this._init(),t}_init(){this._hasEvents=!1,this.deflate=new te,this.deflate.push("[",ae.Z_NO_FLUSH)}},re={clear:()=>{se.clear()},addEvent:t=>se.addEvent(t),finish:()=>se.finish(),compress:t=>function(t){return ee(t)}(t)};addEventListener("message",(function(t){const e=t.data.method,a=t.data.id,s=t.data.arg;if(e in re&&"function"==typeof re[e])try{const t=re[e](s);postMessage({id:a,method:e,success:!0,response:t})}catch(t){postMessage({id:a,method:e,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});']);return URL.createObjectURL(t)}function logInfo(t,r){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&(M.kg.info(t),r&&addBreadcrumb(t))}function logInfoNextTick(t,r){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&(M.kg.info(t),r&&setTimeout(()=>{addBreadcrumb(t)},0))}function addBreadcrumb(t){let r=(0,S.Gd)();r.addBreadcrumb({category:"console",data:{logger:"replay"},level:"info",message:t},{level:"info"})}let EventBufferSizeExceededError=class EventBufferSizeExceededError extends Error{constructor(){super("Event buffer exceeded maximum size of 20000000.")}};let EventBufferArray=class EventBufferArray{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(t){let r=JSON.stringify(t).length;if(this._totalSize+=r,this._totalSize>2e7)throw new EventBufferSizeExceededError;this.events.push(t)}finish(){return new Promise(t=>{let r=this.events;this.clear(),t(JSON.stringify(r))})}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){let t=this.events.map(t=>t.timestamp).sort()[0];return t?timestampToMs(t):null}};let WorkerHandler=class WorkerHandler{constructor(t){this._worker=t,this._id=0}ensureReady(){return this._ensureReadyPromise||(this._ensureReadyPromise=new Promise((t,r)=>{this._worker.addEventListener("message",({data:n})=>{n.success?t():r()},{once:!0}),this._worker.addEventListener("error",t=>{r(t)},{once:!0})})),this._ensureReadyPromise}destroy(){logInfo("[Replay] Destroying compression worker"),this._worker.terminate()}postMessage(t,r){let n=this._getAndIncrementId();return new Promise((s,a)=>{let listener=({data:r})=>{if(r.method===t&&r.id===n){if(this._worker.removeEventListener("message",listener),!r.success){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay]",r.response),a(Error("Error in compression worker"));return}s(r.response)}};this._worker.addEventListener("message",listener),this._worker.postMessage({id:n,method:t,arg:r})})}_getAndIncrementId(){return this._id++}};let EventBufferCompressionWorker=class EventBufferCompressionWorker{constructor(t){this._worker=new WorkerHandler(t),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(t){let r=timestampToMs(t.timestamp);(!this._earliestTimestamp||r<this._earliestTimestamp)&&(this._earliestTimestamp=r);let n=JSON.stringify(t);return(this._totalSize+=n.length,this._totalSize>2e7)?Promise.reject(new EventBufferSizeExceededError):this._sendEventToWorker(n)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear")}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(t){return this._worker.postMessage("addEvent",t)}async _finishRequest(){let t=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,t}};let EventBufferProxy=class EventBufferProxy{constructor(t){this._fallback=new EventBufferArray,this._compression=new EventBufferCompressionWorker(t),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(t){this._used.hasCheckout=t}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(t){return this._used.addEvent(t)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(t){logInfo("[Replay] Failed to load the compression worker, falling back to simple buffer");return}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){let{events:t,hasCheckout:r}=this._fallback,n=[];for(let r of t)n.push(this._compression.addEvent(r));this._compression.hasCheckout=r,this._used=this._compression;try{await Promise.all(n)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("[Replay] Failed to add events when switching buffers.",t)}}};function createEventBuffer({useCompression:t,workerUrl:r}){if(t&&window.Worker){let t=_loadWorker(r);if(t)return t}return logInfo("[Replay] Using simple buffer"),new EventBufferArray}function _loadWorker(t){try{let r=t||_getWorkerUrl();if(!r)return;logInfo(`[Replay] Using compression worker${t?` from ${t}`:""}`);let n=new Worker(r);return new EventBufferProxy(n)}catch(t){logInfo("[Replay] Failed to create compression worker")}}function _getWorkerUrl(){return"undefined"!=typeof __SENTRY_EXCLUDE_REPLAY_WORKER__&&__SENTRY_EXCLUDE_REPLAY_WORKER__?"":e()}function hasSessionStorage(){try{return"sessionStorage"in z&&!!z.sessionStorage}catch(t){return!1}}function clearSession(t){deleteSession(),t.session=void 0}function deleteSession(){if(hasSessionStorage())try{z.sessionStorage.removeItem(U)}catch(t){}}function isSampled(t){return void 0!==t&&Math.random()<t}function saveSession(t){if(hasSessionStorage())try{z.sessionStorage.setItem(U,JSON.stringify(t))}catch(t){}}function makeSession(t){let r=Date.now(),n=t.id||(0,N.DM)(),s=t.started||r,a=t.lastActivity||r,i=t.segmentId||0,o=t.sampled,l=t.previousSessionId;return{id:n,started:s,lastActivity:a,segmentId:i,sampled:o,previousSessionId:l}}function getSessionSampleType(t,r){return isSampled(t)?"session":!!r&&"buffer"}function createSession({sessionSampleRate:t,allowBuffering:r,stickySession:n=!1},{previousSessionId:s}={}){let a=getSessionSampleType(t,r),i=makeSession({sampled:a,previousSessionId:s});return n&&saveSession(i),i}function fetchSession(t){if(!hasSessionStorage())return null;try{let r=z.sessionStorage.getItem(U);if(!r)return null;let n=JSON.parse(r);return logInfoNextTick("[Replay] Loading existing session",t),makeSession(n)}catch(t){return null}}function isExpired(t,r,n=+new Date){return null===t||void 0===r||r<0||0!==r&&t+r<=n}function isSessionExpired(t,{maxReplayDuration:r,sessionIdleExpire:n,targetTime:s=Date.now()}){return isExpired(t.started,r,s)||isExpired(t.lastActivity,n,s)}function shouldRefreshSession(t,{sessionIdleExpire:r,maxReplayDuration:n}){return!!isSessionExpired(t,{sessionIdleExpire:r,maxReplayDuration:n})&&("buffer"!==t.sampled||0!==t.segmentId)}function loadOrCreateSession({traceInternals:t,sessionIdleExpire:r,maxReplayDuration:n,previousSessionId:s},a){let i=a.stickySession&&fetchSession(t);return i?shouldRefreshSession(i,{sessionIdleExpire:r,maxReplayDuration:n})?(logInfoNextTick("[Replay] Session in sessionStorage is expired, creating new one..."),createSession(a,{previousSessionId:i.id})):i:(logInfoNextTick("[Replay] Creating new session",t),createSession(a,{previousSessionId:s}))}function isCustomEvent(t){return t.type===$.Custom}function addEventSync(t,r,n){return!!shouldAddEvent(t,r)&&(_addEvent(t,r,n),!0)}function addEvent(t,r,n){return shouldAddEvent(t,r)?_addEvent(t,r,n):Promise.resolve(null)}async function _addEvent(t,r,n){if(!t.eventBuffer)return null;try{n&&"buffer"===t.recordingMode&&t.eventBuffer.clear(),n&&(t.eventBuffer.hasCheckout=!0);let s=t.getOptions(),a=maybeApplyCallback(r,s.beforeAddRecordingEvent);if(!a)return;return await t.eventBuffer.addEvent(a)}catch(s){let r=s&&s instanceof EventBufferSizeExceededError?"addEventSizeExceeded":"addEvent";("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error(s),await t.stop({reason:r});let n=(0,S.Gd)().getClient();n&&n.recordDroppedEvent("internal_sdk_error","replay")}}function shouldAddEvent(t,r){if(!t.eventBuffer||t.isPaused()||!t.isEnabled())return!1;let n=timestampToMs(r.timestamp);return!(n+t.timeouts.sessionIdlePause<Date.now())&&(!(n>t.getContext().initialTimestamp+t.getOptions().maxReplayDuration)||(logInfo(`[Replay] Skipping event with timestamp ${n} because it is after maxReplayDuration`,t.getOptions()._experiments.traceInternals),!1))}function maybeApplyCallback(t,r){try{if("function"==typeof r&&isCustomEvent(t))return r(t)}catch(t){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] An error occured in the `beforeAddRecordingEvent` callback, skipping the event...",t),null}return t}function isTransactionEvent(t){return"transaction"===t.type}function isReplayEvent(t){return"replay_event"===t.type}function handleAfterSendEvent(t){let r=isBaseTransportSend();return(n,s)=>{if(!t.isEnabled()||n.type&&!isTransactionEvent(n))return;let a=s&&s.statusCode;if(!r||a&&!(a<200)&&!(a>=300)){if(isTransactionEvent(n)){handleTransactionEvent(t,n);return}handleErrorEvent(t,n)}}}function handleTransactionEvent(t,r){let n=t.getContext();r.contexts&&r.contexts.trace&&r.contexts.trace.trace_id&&n.traceIds.size<100&&n.traceIds.add(r.contexts.trace.trace_id)}function handleErrorEvent(t,r){let n=t.getContext();r.event_id&&n.errorIds.size<100&&n.errorIds.add(r.event_id),"buffer"===t.recordingMode&&r.tags&&r.tags.replayId&&setTimeout(()=>{t.sendBufferedReplayOrFlush()})}function isBaseTransportSend(){let t=(0,S.Gd)().getClient();if(!t)return!1;let r=t.getTransport();return!!r&&(r.send.__sentry__baseTransport__||!1)}function isRrwebError(t,r){return!t.type&&!!t.exception&&!!t.exception.values&&!!t.exception.values.length&&!!r.originalException&&!!r.originalException.__rrweb__}function shouldSampleForBufferEvent(t,r){return"buffer"===t.recordingMode&&r.message!==W&&!!r.exception&&!r.type&&isSampled(t.getOptions().errorSampleRate)}function handleGlobalEventListener(t,r=!1){let n=r?handleAfterSendEvent(t):void 0;return Object.assign((r,s)=>{if(!t.isEnabled())return r;if(isReplayEvent(r))return delete r.breadcrumbs,r;if(r.type&&!isTransactionEvent(r))return r;let a=t.checkAndHandleExpiredSession();if(!a)return r;if(isRrwebError(r,s)&&!t.getOptions()._experiments.captureExceptions)return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.log("[Replay] Ignoring error from rrweb internals",r),null;let i=shouldSampleForBufferEvent(t,r),o=i||"session"===t.recordingMode;return o&&(r.tags={...r.tags,replayId:t.getSessionId()}),n&&n(r,{statusCode:200}),r},{id:"Replay"})}function createPerformanceSpans(t,r){return r.map(({type:r,start:n,end:s,name:a,data:i})=>{let o=t.throttledAddEvent({type:$.Custom,timestamp:n,data:{tag:"performanceSpan",payload:{op:r,description:a,startTimestamp:n,endTimestamp:s,data:i}}});return"string"==typeof o?Promise.resolve(null):o})}function handleHistory(t){let{from:r,to:n}=t,s=Date.now()/1e3;return{type:"navigation.push",start:s,end:s,name:n,data:{previous:r}}}function handleHistorySpanListener(t){return r=>{if(!t.isEnabled())return;let n=handleHistory(r);null!==n&&(t.getContext().urls.push(n.name),t.triggerUserActivity(),t.addUpdate(()=>(createPerformanceSpans(t,[n]),!1)))}}function shouldFilterRequest(t,r){return(!("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)||!t.getOptions()._experiments.traceInternals)&&(0,C.W)(r,(0,S.Gd)())}function addNetworkBreadcrumb(t,r){!t.isEnabled()||null===r||shouldFilterRequest(t,r.name)||t.addUpdate(()=>(createPerformanceSpans(t,[r]),!0))}function handleFetch(t){let{startTimestamp:r,endTimestamp:n,fetchData:s,response:a}=t;if(!n)return null;let{method:i,url:o}=s;return{type:"resource.fetch",start:r/1e3,end:n/1e3,name:o,data:{method:i,statusCode:a?a.status:void 0}}}function handleFetchSpanListener(t){return r=>{if(!t.isEnabled())return;let n=handleFetch(r);addNetworkBreadcrumb(t,n)}}function handleXhr(t){let{startTimestamp:r,endTimestamp:n,xhr:s}=t,a=s[D.xU];if(!r||!n||!a)return null;let{method:i,url:o,status_code:l}=a;return void 0===o?null:{type:"resource.xhr",name:o,start:r/1e3,end:n/1e3,data:{method:i,statusCode:l}}}function handleXhrSpanListener(t){return r=>{if(!t.isEnabled())return;let n=handleXhr(r);addNetworkBreadcrumb(t,n)}}let ef=["true","false","null"];function completeJson(t,r){if(!r.length)return t;let n=t,s=r.length-1,a=r[s];n=_fixLastStep(n,a);for(let t=s;t>=0;t--){let s=r[t];switch(s){case 10:n=`${n}}`;break;case 20:n=`${n}]`}}return n}function _fixLastStep(t,r){switch(r){case 10:return`${t}"~~":"~~"`;case 11:return`${t}:"~~"`;case 12:return`${t}~~":"~~"`;case 13:return _maybeFixIncompleteObjValue(t);case 14:case 22:return`${t}~~"`;case 15:return`${t},"~~":"~~"`;case 20:return`${t}"~~"`;case 21:return _maybeFixIncompleteArrValue(t);case 23:return`${t},"~~"`}return t}function _maybeFixIncompleteArrValue(t){let r=_findLastArrayDelimiter(t);if(r>-1){let n=t.slice(r+1);return ef.includes(n.trim())?`${t},"~~"`:`${t.slice(0,r+1)}"~~"`}return t}function _findLastArrayDelimiter(t){for(let r=t.length-1;r>=0;r--){let n=t[r];if(","===n||"["===n)return r}return -1}function _maybeFixIncompleteObjValue(t){let r=t.lastIndexOf(":"),n=t.slice(r+1);return ef.includes(n.trim())?`${t},"~~":"~~"`:`${t.slice(0,r+1)}"~~"`}function evaluateJson(t){let r=[];for(let n=0;n<t.length;n++)_evaluateJsonPos(r,t,n);return r}function _evaluateJsonPos(t,r,n){let s=t[t.length-1],a=r[n];if(!/\s/.test(a)){if('"'===a&&!_isEscaped(r,n)){_handleQuote(t,s);return}switch(a){case"{":_handleObj(t,s);break;case"[":_handleArr(t,s);break;case":":_handleColon(t,s);break;case",":_handleComma(t,s);break;case"}":_handleObjClose(t,s);break;case"]":_handleArrClose(t,s)}}}function _handleQuote(t,r){if(14===r){t.pop(),t.push(15);return}if(22===r){t.pop(),t.push(23);return}if(13===r){t.push(14);return}if(21===r){t.push(22);return}if(10===r){t.push(12);return}if(12===r){t.pop(),t.push(11);return}}function _handleObj(t,r){if(!r||13===r||(21===r&&t.push(10),20===r)){t.push(10);return}}function _handleArr(t,r){if(!r||13===r||(21===r&&(t.push(20),t.push(21)),20===r)){t.push(20),t.push(21);return}}function _handleColon(t,r){11===r&&(t.pop(),t.push(13))}function _handleComma(t,r){if(13===r){t.pop();return}if(15===r){t.pop(),t.pop();return}if(21!==r&&23===r){t.pop();return}}function _handleObjClose(t,r){10===r&&t.pop(),13===r&&(t.pop(),t.pop()),15===r&&(t.pop(),t.pop(),t.pop()),13===t[t.length-1]&&t.push(15),21===t[t.length-1]&&t.push(23)}function _handleArrClose(t,r){20===r&&t.pop(),21===r&&(t.pop(),t.pop()),23===r&&(t.pop(),t.pop(),t.pop()),13===t[t.length-1]&&t.push(15),21===t[t.length-1]&&t.push(23)}function _isEscaped(t,r){let n=t[r-1];return"\\"===n&&!_isEscaped(t,r-1)}function fixJson(t){let r=evaluateJson(t);return completeJson(t,r)}function getBodySize(t,r){if(t)try{if("string"==typeof t)return r.encode(t).length;if(t instanceof URLSearchParams)return r.encode(t.toString()).length;if(t instanceof FormData){let n=_serializeFormData(t);return r.encode(n).length}if(t instanceof Blob)return t.size;if(t instanceof ArrayBuffer)return t.byteLength}catch(t){}}function parseContentLengthHeader(t){if(!t)return;let r=parseInt(t,10);return isNaN(r)?void 0:r}function getBodyString(t){return"string"==typeof t?t:t instanceof URLSearchParams?t.toString():t instanceof FormData?_serializeFormData(t):void 0}function makeNetworkReplayBreadcrumb(t,r){if(!r)return null;let{startTimestamp:n,endTimestamp:s,url:a,method:i,statusCode:o,request:l,response:d}=r,c={type:t,start:n/1e3,end:s/1e3,name:a,data:(0,R.Jr)({method:i,statusCode:o,request:l,response:d})};return c}function buildSkippedNetworkRequestOrResponse(t){return{headers:{},size:t,_meta:{warnings:["URL_SKIPPED"]}}}function buildNetworkRequestOrResponse(t,r,n){if(!r&&0===Object.keys(t).length)return;if(!r)return{headers:t};if(!n)return{headers:t,size:r};let s={headers:t,size:r},{body:a,warnings:i}=normalizeNetworkBody(n);return s.body=a,i.length>0&&(s._meta={warnings:i}),s}function getAllowedHeaders(t,r){return Object.keys(t).reduce((n,s)=>{let a=s.toLowerCase();return r.includes(a)&&t[s]&&(n[a]=t[s]),n},{})}function _serializeFormData(t){return new URLSearchParams(t).toString()}function normalizeNetworkBody(t){if(!t||"string"!=typeof t)return{body:t,warnings:[]};let r=t.length>15e4;if(_strIsProbablyJson(t))try{let n=r?fixJson(t.slice(0,15e4)):t,s=JSON.parse(n);return{body:s,warnings:r?["JSON_TRUNCATED"]:[]}}catch(n){return{body:r?`${t.slice(0,15e4)}…`:t,warnings:r?["INVALID_JSON","TEXT_TRUNCATED"]:["INVALID_JSON"]}}return{body:r?`${t.slice(0,15e4)}…`:t,warnings:r?["TEXT_TRUNCATED"]:[]}}function _strIsProbablyJson(t){let r=t[0],n=t[t.length-1];return"["===r&&"]"===n||"{"===r&&"}"===n}function urlMatches(t,r){let n=getFullUrl(t);return(0,O.U0)(n,r)}function getFullUrl(t,r=z.document.baseURI){if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith(z.location.origin))return t;let n=new URL(t,r);if(n.origin!==new URL(r).origin)return t;let s=n.href;return!t.endsWith("/")&&s.endsWith("/")?s.slice(0,-1):s}async function captureFetchBreadcrumbToReplay(t,r,n){try{let s=await _prepareFetchData(t,r,n),a=makeNetworkReplayBreadcrumb("resource.fetch",s);addNetworkBreadcrumb(n.replay,a)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] Failed to capture fetch breadcrumb",t)}}function enrichFetchBreadcrumb(t,r,n){let{input:s,response:a}=r,i=_getFetchRequestArgBody(s),o=getBodySize(i,n.textEncoder),l=a?parseContentLengthHeader(a.headers.get("content-length")):void 0;void 0!==o&&(t.data.request_body_size=o),void 0!==l&&(t.data.response_body_size=l)}async function _prepareFetchData(t,r,n){let{startTimestamp:s,endTimestamp:a}=r,{url:i,method:o,status_code:l=0,request_body_size:d,response_body_size:c}=t.data,u=urlMatches(i,n.networkDetailAllowUrls)&&!urlMatches(i,n.networkDetailDenyUrls),h=u?_getRequestInfo(n,r.input,d):buildSkippedNetworkRequestOrResponse(d),p=await _getResponseInfo(u,n,r.response,c);return{startTimestamp:s,endTimestamp:a,url:i,method:o,statusCode:l,request:h,response:p}}function _getRequestInfo({networkCaptureBodies:t,networkRequestHeaders:r},n,s){let a=getRequestHeaders(n,r);if(!t)return buildNetworkRequestOrResponse(a,s,void 0);let i=_getFetchRequestArgBody(n),o=getBodyString(i);return buildNetworkRequestOrResponse(a,s,o)}async function _getResponseInfo(t,{networkCaptureBodies:r,textEncoder:n,networkResponseHeaders:s},a,i){if(!t&&void 0!==i)return buildSkippedNetworkRequestOrResponse(i);let o=getAllHeaders(a.headers,s);if(!r&&void 0!==i)return buildNetworkRequestOrResponse(o,i,void 0);try{let s=a.clone(),l=await _parseFetchBody(s),d=l&&l.length&&void 0===i?getBodySize(l,n):i;if(!t)return buildSkippedNetworkRequestOrResponse(d);if(r)return buildNetworkRequestOrResponse(o,d,l);return buildNetworkRequestOrResponse(o,d,void 0)}catch(t){return buildNetworkRequestOrResponse(o,i,void 0)}}async function _parseFetchBody(t){try{return await t.text()}catch(t){return}}function _getFetchRequestArgBody(t=[]){if(2===t.length&&"object"==typeof t[1])return t[1].body}function getAllHeaders(t,r){let n={};return r.forEach(r=>{t.get(r)&&(n[r]=t.get(r))}),n}function getRequestHeaders(t,r){return 1===t.length&&"string"!=typeof t[0]?getHeadersFromOptions(t[0],r):2===t.length?getHeadersFromOptions(t[1],r):{}}function getHeadersFromOptions(t,r){if(!t)return{};let n=t.headers;return n?n instanceof Headers?getAllHeaders(n,r):Array.isArray(n)?{}:getAllowedHeaders(n,r):{}}async function captureXhrBreadcrumbToReplay(t,r,n){try{let s=_prepareXhrData(t,r,n),a=makeNetworkReplayBreadcrumb("resource.xhr",s);addNetworkBreadcrumb(n.replay,a)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] Failed to capture xhr breadcrumb",t)}}function enrichXhrBreadcrumb(t,r,n){let{xhr:s,input:a}=r,i=getBodySize(a,n.textEncoder),o=s.getResponseHeader("content-length")?parseContentLengthHeader(s.getResponseHeader("content-length")):getBodySize(s.response,n.textEncoder);void 0!==i&&(t.data.request_body_size=i),void 0!==o&&(t.data.response_body_size=o)}function _prepareXhrData(t,r,n){let{startTimestamp:s,endTimestamp:a,input:i,xhr:o}=r,{url:l,method:d,status_code:c=0,request_body_size:u,response_body_size:h}=t.data;if(!l)return null;if(!urlMatches(l,n.networkDetailAllowUrls)||urlMatches(l,n.networkDetailDenyUrls)){let t=buildSkippedNetworkRequestOrResponse(u),r=buildSkippedNetworkRequestOrResponse(h);return{startTimestamp:s,endTimestamp:a,url:l,method:d,statusCode:c,request:t,response:r}}let p=o[D.xU],g=p?getAllowedHeaders(p.request_headers,n.networkRequestHeaders):{},m=getAllowedHeaders(getResponseHeaders(o),n.networkResponseHeaders),f=buildNetworkRequestOrResponse(g,u,n.networkCaptureBodies?getBodyString(i):void 0),_=buildNetworkRequestOrResponse(m,h,n.networkCaptureBodies?r.xhr.responseText:void 0);return{startTimestamp:s,endTimestamp:a,url:l,method:d,statusCode:c,request:f,response:_}}function getResponseHeaders(t){let r=t.getAllResponseHeaders();return r?r.split("\r\n").reduce((t,r)=>{let[n,s]=r.split(": ");return t[n.toLowerCase()]=s,t},{}):{}}function handleNetworkBreadcrumbs(t){let r=(0,S.Gd)().getClient();try{let n=new TextEncoder,{networkDetailAllowUrls:s,networkDetailDenyUrls:a,networkCaptureBodies:i,networkRequestHeaders:o,networkResponseHeaders:l}=t.getOptions(),d={replay:t,textEncoder:n,networkDetailAllowUrls:s,networkDetailDenyUrls:a,networkCaptureBodies:i,networkRequestHeaders:o,networkResponseHeaders:l};r&&r.on?r.on("beforeAddBreadcrumb",(t,r)=>beforeAddNetworkBreadcrumb(d,t,r)):((0,D.oq)("fetch",handleFetchSpanListener(t)),(0,D.oq)("xhr",handleXhrSpanListener(t)))}catch(t){}}function beforeAddNetworkBreadcrumb(t,r,n){if(r.data)try{_isXhrBreadcrumb(r)&&_isXhrHint(n)&&(enrichXhrBreadcrumb(r,n,t),captureXhrBreadcrumbToReplay(r,n,t)),_isFetchBreadcrumb(r)&&_isFetchHint(n)&&(enrichFetchBreadcrumb(r,n,t),captureFetchBreadcrumbToReplay(r,n,t))}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("Error when enriching network breadcrumb")}}function _isXhrBreadcrumb(t){return"xhr"===t.category}function _isFetchBreadcrumb(t){return"fetch"===t.category}function _isXhrHint(t){return t&&t.xhr}function _isFetchHint(t){return t&&t.response}let e_=null;function isBreadcrumbWithCategory(t){return!!t.category}let handleScopeListener=t=>r=>{if(!t.isEnabled())return;let n=handleScope(r);n&&addBreadcrumbEvent(t,n)};function handleScope(t){let r=t.getLastBreadcrumb&&t.getLastBreadcrumb();return e_!==r&&r?(e_=r,!isBreadcrumbWithCategory(r)||["fetch","xhr","sentry.event","sentry.transaction"].includes(r.category)||r.category.startsWith("ui."))?null:"console"===r.category?normalizeConsoleBreadcrumb(r):createBreadcrumb(r):null}function normalizeConsoleBreadcrumb(t){let r=t.data&&t.data.arguments;if(!Array.isArray(r)||0===r.length)return createBreadcrumb(t);let n=!1,s=r.map(t=>{if(!t)return t;if("string"==typeof t)return t.length>5e3?(n=!0,`${t.slice(0,5e3)}…`):t;if("object"==typeof t)try{let r=(0,A.Fv)(t,7),s=JSON.stringify(r);if(s.length>5e3){let t=fixJson(s.slice(0,5e3)),r=JSON.parse(t);return n=!0,r}return r}catch(t){}return t});return createBreadcrumb({...t,data:{...t.data,arguments:s,...n?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}function addGlobalListeners(t){let r=(0,S.Gd)().getScope(),n=(0,S.Gd)().getClient();r.addScopeListener(handleScopeListener(t)),(0,D.oq)("dom",handleDomListener(t)),(0,D.oq)("history",handleHistorySpanListener(t)),handleNetworkBreadcrumbs(t);let s=handleGlobalEventListener(t,!(n&&n.on));n&&n.addEventProcessor?n.addEventProcessor(s):(0,v.cc)(s),n&&n.on&&(n.on("afterSendEvent",handleAfterSendEvent(t)),n.on("createDsc",r=>{let n=t.getSessionId();if(n&&t.isEnabled()&&"session"===t.recordingMode){let s=t.checkAndHandleExpiredSession();s&&(r.replay_id=n)}}),n.on("startTransaction",r=>{t.lastTransaction=r}),n.on("finishTransaction",r=>{t.lastTransaction=r}))}async function addMemoryEntry(t){try{return Promise.all(createPerformanceSpans(t,[createMemoryEntry(z.performance.memory)]))}catch(t){return[]}}function createMemoryEntry(t){let{jsHeapSizeLimit:r,totalJSHeapSize:n,usedJSHeapSize:s}=t,a=Date.now()/1e3;return{type:"memory",name:"memory",start:a,end:a,data:{memory:{jsHeapSizeLimit:r,totalJSHeapSize:n,usedJSHeapSize:s}}}}function debounce(t,r,n){let s,a,i;let o=n&&n.maxWait?Math.max(n.maxWait,r):0;function invokeFunc(){return cancelTimers(),s=t()}function cancelTimers(){void 0!==a&&clearTimeout(a),void 0!==i&&clearTimeout(i),a=i=void 0}function flush(){return void 0!==a||void 0!==i?invokeFunc():s}function debounced(){return a&&clearTimeout(a),a=setTimeout(invokeFunc,r),o&&void 0===i&&(i=setTimeout(invokeFunc,o)),s}return debounced.cancel=cancelTimers,debounced.flush=flush,debounced}function getHandleRecordingEmit(t){let r=!1;return(n,s)=>{if(!t.checkAndHandleExpiredSession()){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.warn("[Replay] Received replay event after session expired.");return}let a=s||!r;r=!0,t.addUpdate(()=>{if("buffer"===t.recordingMode&&a&&t.setInitialState(),!addEventSync(t,n,a))return!0;if(!a)return!1;if(addSettingsEvent(t,a),t.session&&t.session.previousSessionId)return!0;if("buffer"===t.recordingMode&&t.session&&t.eventBuffer){let r=t.eventBuffer.getEarliestTimestamp();r&&(logInfo(`[Replay] Updating session start time to earliest event in buffer to ${new Date(r)}`,t.getOptions()._experiments.traceInternals),t.session.started=r,t.getOptions().stickySession&&saveSession(t.session))}return"session"===t.recordingMode&&t.flush(),!0})}}function createOptionsEvent(t){let r=t.getOptions();return{type:$.Custom,timestamp:Date.now(),data:{tag:"options",payload:{sessionSampleRate:r.sessionSampleRate,errorSampleRate:r.errorSampleRate,useCompressionOption:r.useCompression,blockAllMedia:r.blockAllMedia,maskAllText:r.maskAllText,maskAllInputs:r.maskAllInputs,useCompression:!!t.eventBuffer&&"worker"===t.eventBuffer.type,networkDetailHasUrls:r.networkDetailAllowUrls.length>0,networkCaptureBodies:r.networkCaptureBodies,networkRequestHasHeaders:r.networkRequestHeaders.length>0,networkResponseHasHeaders:r.networkResponseHeaders.length>0}}}}function addSettingsEvent(t,r){r&&t.session&&0===t.session.segmentId&&addEventSync(t,createOptionsEvent(t),!1)}function createReplayEnvelope(t,r,n,s){return(0,B.Jd)((0,B.Cd)(t,(0,B.HY)(t),s,n),[[{type:"replay_event"},t],[{type:"replay_recording",length:"string"==typeof r?new TextEncoder().encode(r).length:r.length},r]])}function prepareRecordingData({recordingData:t,headers:r}){let n;let s=`${JSON.stringify(r)}
`;if("string"==typeof t)n=`${s}${t}`;else{let r=new TextEncoder,a=r.encode(s);(n=new Uint8Array(a.length+t.length)).set(a),n.set(t,a.length)}return n}async function prepareReplayEvent({client:t,scope:r,replayId:n,event:s}){let a="object"!=typeof t._integrations||null===t._integrations||Array.isArray(t._integrations)?void 0:Object.keys(t._integrations),i={event_id:n,integrations:a};t.emit&&t.emit("preprocessEvent",s,i);let o=await (0,w.R)(t.getOptions(),s,i,r,t);if(!o)return null;o.platform=o.platform||"javascript";let l=t.getSdkMetadata&&t.getSdkMetadata(),{name:d,version:c}=l&&l.sdk||{};return o.sdk={...o.sdk,name:d||"sentry.javascript.unknown",version:c||"0.0.0"},o}async function sendReplayRequest({recordingData:t,replayId:r,segmentId:n,eventContext:s,timestamp:a,session:i}){let o;let l=prepareRecordingData({recordingData:t,headers:{segment_id:n}}),{urls:d,errorIds:c,traceIds:u,initialTimestamp:h}=s,p=(0,S.Gd)(),g=p.getClient(),m=p.getScope(),f=g&&g.getTransport(),_=g&&g.getDsn();if(!g||!f||!_||!i.sampled)return;let y={type:"replay_event",replay_start_timestamp:h/1e3,timestamp:a/1e3,error_ids:c,trace_ids:u,urls:d,replay_id:r,segment_id:n,replay_type:i.sampled},b=await prepareReplayEvent({scope:m,client:g,replayId:r,event:y});if(!b){g.recordDroppedEvent("event_processor","replay",y),logInfo("An event processor returned `null`, will not send event.");return}delete b.sdkProcessingMetadata;let I=createReplayEnvelope(b,l,_,g.getOptions().tunnel);try{o=await f.send(I)}catch(r){let t=Error(W);try{t.cause=r}catch(t){}throw t}if(!o)return o;if("number"==typeof o.statusCode&&(o.statusCode<200||o.statusCode>=300))throw new TransportStatusCodeError(o.statusCode);return o}let TransportStatusCodeError=class TransportStatusCodeError extends Error{constructor(t){super(`Transport returned status code ${t}`)}};async function sendReplay(t,r={count:0,interval:5e3}){let{recordingData:n,options:s}=t;if(n.length)try{return await sendReplayRequest(t),!0}catch(n){if(n instanceof TransportStatusCodeError)throw n;if((0,E.v)("Replays",{_retryCount:r.count}),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&s._experiments&&s._experiments.captureExceptions&&(0,E.Tb)(n),r.count>=3){let t=Error(`${W} - max retries exceeded`);try{t.cause=n}catch(t){}throw t}return r.interval*=++r.count,new Promise((n,s)=>{setTimeout(async()=>{try{await sendReplay(t,r),n(!0)}catch(t){s(t)}},r.interval)})}}let ey="__THROTTLED";function throttle(t,r,n){let s=new Map,_cleanup=t=>{let r=t-n;s.forEach((t,n)=>{n<r&&s.delete(n)})},_getTotalCount=()=>[...s.values()].reduce((t,r)=>t+r,0),a=!1;return(...n)=>{let i=Math.floor(Date.now()/1e3);if(_cleanup(i),_getTotalCount()>=r){let t=a;return a=!0,t?"__SKIPPED":ey}a=!1;let o=s.get(i)||0;return s.set(i,o+1),t(...n)}}let ReplayContainer=class ReplayContainer{constructor({options:t,recordingOptions:r}){ReplayContainer.prototype.__init.call(this),ReplayContainer.prototype.__init2.call(this),ReplayContainer.prototype.__init3.call(this),ReplayContainer.prototype.__init4.call(this),ReplayContainer.prototype.__init5.call(this),ReplayContainer.prototype.__init6.call(this),this.eventBuffer=null,this.performanceEntries=[],this.replayPerformanceEntries=[],this.recordingMode="session",this.timeouts={sessionIdlePause:3e5,sessionIdleExpire:9e5},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=r,this._options=t,this._debouncedFlush=debounce(()=>this._flush(),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=throttle((t,r)=>addEvent(this,t,r),300,5);let{slowClickTimeout:n,slowClickIgnoreSelectors:s}=this.getOptions(),a=n?{threshold:Math.min(3e3,n),timeout:n,scrollTimeout:300,ignoreSelector:s?s.join(","):""}:void 0;a&&(this.clickDetector=new ClickDetector(this,a))}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}getOptions(){return this._options}initializeSampling(t){let{errorSampleRate:r,sessionSampleRate:n}=this._options;if(!(r<=0)||!(n<=0)){if(this._initializeSessionForSampling(t),!this.session){this._handleException(Error("Unable to initialize and create session"));return}!1!==this.session.sampled&&(this.recordingMode="buffer"===this.session.sampled&&0===this.session.segmentId?"buffer":"session",logInfoNextTick(`[Replay] Starting replay in ${this.recordingMode} mode`,this._options._experiments.traceInternals),this._initializeRecording())}}start(){if(this._isEnabled&&"session"===this.recordingMode)throw Error("Replay recording is already in progress");if(this._isEnabled&&"buffer"===this.recordingMode)throw Error("Replay buffering is in progress, call `flush()` to save the replay");logInfoNextTick("[Replay] Starting replay in session mode",this._options._experiments.traceInternals);let t=loadOrCreateSession({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=t,this._initializeRecording()}startBuffering(){if(this._isEnabled)throw Error("Replay recording is already in progress");logInfoNextTick("[Replay] Starting replay in buffer mode",this._options._experiments.traceInternals);let t=loadOrCreateSession({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=t,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{this._stopRecording=record({...this._recordingOptions,..."buffer"===this.recordingMode&&{checkoutEveryNms:6e4},emit:getHandleRecordingEmit(this),onMutation:this._onMutationHandler})}catch(t){this._handleException(t)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(t){return this._handleException(t),!1}}async stop({forceFlush:t=!1,reason:r}={}){if(this._isEnabled){this._isEnabled=!1;try{logInfo(`[Replay] Stopping Replay${r?` triggered by ${r}`:""}`,this._options._experiments.traceInternals),this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),t&&await this._flush({force:!0}),this.eventBuffer&&this.eventBuffer.destroy(),this.eventBuffer=null,clearSession(this)}catch(t){this._handleException(t)}}}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),logInfo("[Replay] Pausing replay",this._options._experiments.traceInternals))}resume(){this._isPaused&&this._checkSession()&&(this._isPaused=!1,this.startRecording(),logInfo("[Replay] Resuming replay",this._options._experiments.traceInternals))}async sendBufferedReplayOrFlush({continueRecording:t=!0}={}){if("session"===this.recordingMode)return this.flushImmediate();let r=Date.now();logInfo("[Replay] Converting buffer to session",this._options._experiments.traceInternals),await this.flushImmediate();let n=this.stopRecording();t&&n&&"session"!==this.recordingMode&&(this.recordingMode="session",this.session&&(this._updateUserActivity(r),this._updateSessionActivity(r),this._maybeSaveSession()),this.startRecording())}addUpdate(t){let r=t();"buffer"!==this.recordingMode&&!0!==r&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),!this._stopRecording){if(!this._checkSession())return;this.resume();return}this.checkAndHandleExpiredSession(),this._updateSessionActivity()}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return"buffer"===this.recordingMode?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){if(this._lastActivity&&isExpired(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&"session"===this.session.sampled){this.pause();return}return!!this._checkSession()}setInitialState(){let t=`${z.location.pathname}${z.location.hash}${z.location.search}`,r=`${z.location.origin}${t}`;this.performanceEntries=[],this.replayPerformanceEntries=[],this._clearContext(),this._context.initialUrl=r,this._context.initialTimestamp=Date.now(),this._context.urls.push(r)}throttledAddEvent(t,r){let n=this._throttledAddEvent(t,r);if(n===ey){let t=createBreadcrumb({category:"replay.throttled"});this.addUpdate(()=>!addEventSync(this,{type:5,timestamp:t.timestamp||0,data:{tag:"breadcrumb",payload:t,metric:!0}}))}return n}getCurrentRoute(){let t=this.lastTransaction||(0,S.Gd)().getScope().getTransaction();if(t&&["route","custom"].includes(t.metadata.source))return t.name}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=createEventBuffer({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_handleException(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay]",t),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&this._options._experiments&&this._options._experiments.captureExceptions&&(0,E.Tb)(t)}_initializeSessionForSampling(t){let r=this._options.errorSampleRate>0,n=loadOrCreateSession({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals,previousSessionId:t},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:r});this.session=n}_checkSession(){if(!this.session)return!1;let t=this.session;return!shouldRefreshSession(t,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})||(this._refreshSession(t),!1)}async _refreshSession(t){this._isEnabled&&(await this.stop({reason:"refresh session"}),this.initializeSampling(t.id))}_addListeners(){try{z.document.addEventListener("visibilitychange",this._handleVisibilityChange),z.addEventListener("blur",this._handleWindowBlur),z.addEventListener("focus",this._handleWindowFocus),z.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(addGlobalListeners(this),this._hasInitializedCoreListeners=!0)}catch(t){this._handleException(t)}this._performanceCleanupCallback=setupPerformanceObserver(this)}_removeListeners(){try{z.document.removeEventListener("visibilitychange",this._handleVisibilityChange),z.removeEventListener("blur",this._handleWindowBlur),z.removeEventListener("focus",this._handleWindowFocus),z.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(t){this._handleException(t)}}__init(){this._handleVisibilityChange=()=>{"visible"===z.document.visibilityState?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init2(){this._handleWindowBlur=()=>{let t=createBreadcrumb({category:"ui.blur"});this._doChangeToBackgroundTasks(t)}}__init3(){this._handleWindowFocus=()=>{let t=createBreadcrumb({category:"ui.focus"});this._doChangeToForegroundTasks(t)}}__init4(){this._handleKeyboardEvent=t=>{handleKeyboardEvent(this,t)}}_doChangeToBackgroundTasks(t){if(!this.session)return;let r=isSessionExpired(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire});r||(t&&this._createCustomBreadcrumb(t),this.conditionalFlush())}_doChangeToForegroundTasks(t){if(!this.session)return;let r=this.checkAndHandleExpiredSession();if(!r){logInfo("[Replay] Document has become active, but session has expired");return}t&&this._createCustomBreadcrumb(t)}_updateUserActivity(t=Date.now()){this._lastActivity=t}_updateSessionActivity(t=Date.now()){this.session&&(this.session.lastActivity=t,this._maybeSaveSession())}_createCustomBreadcrumb(t){this.addUpdate(()=>{this.throttledAddEvent({type:$.Custom,timestamp:t.timestamp||0,data:{tag:"breadcrumb",payload:t}})})}_addPerformanceEntries(){let t=createPerformanceEntries(this.performanceEntries).concat(this.replayPerformanceEntries);return this.performanceEntries=[],this.replayPerformanceEntries=[],Promise.all(createPerformanceSpans(this,t))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){let{session:t,eventBuffer:r}=this;if(!t||!r||t.segmentId)return;let n=r.getEarliestTimestamp();n&&n<this._context.initialTimestamp&&(this._context.initialTimestamp=n)}_popEventContext(){let t={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),t}async _runFlush(){let t=this.getSessionId();if(!this.session||!this.eventBuffer||!t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] No session or eventBuffer found to flush.");return}if(await this._addPerformanceEntries(),this.eventBuffer&&this.eventBuffer.hasEvents&&(await addMemoryEntry(this),this.eventBuffer&&t===this.getSessionId()))try{this._updateInitialTimestampFromEventBuffer();let r=Date.now();if(r-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw Error("Session is too long, not sending replay");let n=this._popEventContext(),s=this.session.segmentId++;this._maybeSaveSession();let a=await this.eventBuffer.finish();await sendReplay({replayId:t,recordingData:a,segmentId:s,eventContext:n,session:this.session,options:this.getOptions(),timestamp:r})}catch(r){this._handleException(r),this.stop({reason:"sendReplay"});let t=(0,S.Gd)().getClient();t&&t.recordDroppedEvent("send_error","replay")}}__init5(){this._flush=async({force:t=!1}={})=>{if(!this._isEnabled&&!t)return;if(!this.checkAndHandleExpiredSession()){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error("[Replay] Attempting to finish replay event after session expired.");return}if(!this.session)return;let r=this.session.started,n=Date.now(),s=n-r;this._debouncedFlush.cancel();let a=s<this._options.minReplayDuration,i=s>this._options.maxReplayDuration+5e3;if(a||i){logInfo(`[Replay] Session duration (${Math.floor(s/1e3)}s) is too ${a?"short":"long"}, not sending replay.`,this._options._experiments.traceInternals),a&&this._debouncedFlush();return}let o=this.eventBuffer;if(o&&0===this.session.segmentId&&!o.hasCheckout&&logInfo("[Replay] Flushing initial segment without checkout.",this._options._experiments.traceInternals),!this._flushLock){this._flushLock=this._runFlush(),await this._flushLock,this._flushLock=void 0;return}try{await this._flushLock}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&M.kg.error(t)}finally{this._debouncedFlush()}}}_maybeSaveSession(){this.session&&this._options.stickySession&&saveSession(this.session)}__init6(){this._onMutationHandler=t=>{let r=t.length,n=this._options.mutationLimit,s=this._options.mutationBreadcrumbLimit,a=n&&r>n;if(r>s||a){let t=createBreadcrumb({category:"replay.mutations",data:{count:r,limit:a}});this._createCustomBreadcrumb(t)}return!a||(this.stop({reason:"mutationLimit",forceFlush:"session"===this.recordingMode}),!1)}}};function getOption(t,r,n,s){let a="string"==typeof s?s.split(","):[],i=[...t,...a,...r];return void 0!==n&&("string"==typeof n&&i.push(`.${n}`),console.warn("[Replay] You are using a deprecated configuration item for privacy. Read the documentation on how to use the new privacy configuration.")),i.join(",")}function getPrivacyOptions({mask:t,unmask:r,block:n,unblock:s,ignore:a,blockClass:i,blockSelector:o,maskTextClass:l,maskTextSelector:d,ignoreClass:c}){let u=getOption(t,[".sentry-mask","[data-sentry-mask]"],l,d),h=getOption(r,[".sentry-unmask","[data-sentry-unmask]"]),p={maskTextSelector:u,unmaskTextSelector:h,blockSelector:getOption(n,[".sentry-block","[data-sentry-block]",'base[href="/"]'],i,o),unblockSelector:getOption(s,[".sentry-unblock","[data-sentry-unblock]"]),ignoreSelector:getOption(a,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'],c)};return i instanceof RegExp&&(p.blockClass=i),l instanceof RegExp&&(p.maskTextClass=l),p}function maskAttribute({el:t,key:r,maskAttributes:n,maskAllText:s,privacyOptions:a,value:i}){return!s||a.unmaskTextSelector&&t.matches(a.unmaskTextSelector)?i:n.includes(r)||"value"===r&&"INPUT"===t.tagName&&["submit","button"].includes(t.getAttribute("type")||"")?i.replace(/[\S]/g,"*"):i}let eb='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',eI=["content-length","content-type","accept"],eS=!1;let Replay=class Replay{static __initStatic(){this.id="Replay"}constructor({flushMinDelay:t=5e3,flushMaxDelay:r=5500,minReplayDuration:n=4999,maxReplayDuration:s=36e5,stickySession:a=!0,useCompression:i=!0,workerUrl:o,_experiments:l={},sessionSampleRate:d,errorSampleRate:c,maskAllText:u=!0,maskAllInputs:h=!0,blockAllMedia:p=!0,mutationBreadcrumbLimit:g=750,mutationLimit:m=1e4,slowClickTimeout:f=7e3,slowClickIgnoreSelectors:_=[],networkDetailAllowUrls:y=[],networkDetailDenyUrls:b=[],networkCaptureBodies:I=!0,networkRequestHeaders:S=[],networkResponseHeaders:C=[],mask:v=[],maskAttributes:w=["title","placeholder"],unmask:E=[],block:k=[],unblock:A=[],ignore:R=[],maskFn:T,beforeAddRecordingEvent:x,blockClass:M,blockSelector:N,maskInputOptions:D,maskTextClass:O,maskTextSelector:B,ignoreClass:F}={}){this.name=Replay.id;let z=getPrivacyOptions({mask:v,unmask:E,block:k,unblock:A,ignore:R,blockClass:M,blockSelector:N,maskTextClass:O,maskTextSelector:B,ignoreClass:F});if(this._recordingOptions={maskAllInputs:h,maskAllText:u,maskInputOptions:{...D||{},password:!0},maskTextFn:T,maskInputFn:T,maskAttributeFn:(t,r,n)=>maskAttribute({maskAttributes:w,maskAllText:u,privacyOptions:z,key:t,value:r,el:n}),...z,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:t=>{try{t.__rrweb__=!0}catch(t){}}},this._initialOptions={flushMinDelay:t,flushMaxDelay:r,minReplayDuration:Math.min(n,15e3),maxReplayDuration:Math.min(s,36e5),stickySession:a,sessionSampleRate:d,errorSampleRate:c,useCompression:i,workerUrl:o,blockAllMedia:p,maskAllInputs:h,maskAllText:u,mutationBreadcrumbLimit:g,mutationLimit:m,slowClickTimeout:f,slowClickIgnoreSelectors:_,networkDetailAllowUrls:y,networkDetailDenyUrls:b,networkCaptureBodies:I,networkRequestHeaders:_getMergedNetworkHeaders(S),networkResponseHeaders:_getMergedNetworkHeaders(C),beforeAddRecordingEvent:x,_experiments:l},"number"==typeof d&&(console.warn(`[Replay] You are passing \`sessionSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysSessionSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysSessionSampleRate: ${d} })`),this._initialOptions.sessionSampleRate=d),"number"==typeof c&&(console.warn(`[Replay] You are passing \`errorSampleRate\` to the Replay integration.
This option is deprecated and will be removed soon.
Instead, configure \`replaysOnErrorSampleRate\` directly in the SDK init options, e.g.:
Sentry.init({ replaysOnErrorSampleRate: ${c} })`),this._initialOptions.errorSampleRate=c),this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${eb}`:eb),this._isInitialized&&(0,L.j)())throw Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return eS}set _isInitialized(t){eS=t}setupOnce(){(0,L.j)()&&(this._setup(),setTimeout(()=>this._initialize()))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:"session"===this._replay.recordingMode}):Promise.resolve()}flush(t){return this._replay&&this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(t):Promise.resolve()}getReplayId(){if(this._replay&&this._replay.isEnabled())return this._replay.getSessionId()}_initialize(){this._replay&&this._replay.initializeSampling()}_setup(){let t=loadReplayOptionsFromClient(this._initialOptions);this._replay=new ReplayContainer({options:t,recordingOptions:this._recordingOptions})}};function loadReplayOptionsFromClient(t){let r=(0,S.Gd)().getClient(),n=r&&r.getOptions(),s={sessionSampleRate:0,errorSampleRate:0,...(0,R.Jr)(t)};return n?(null==t.sessionSampleRate&&null==t.errorSampleRate&&null==n.replaysSessionSampleRate&&null==n.replaysOnErrorSampleRate&&console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set."),"number"==typeof n.replaysSessionSampleRate&&(s.sessionSampleRate=n.replaysSessionSampleRate),"number"==typeof n.replaysOnErrorSampleRate&&(s.errorSampleRate=n.replaysOnErrorSampleRate)):console.warn("SDK client is not available."),s}function _getMergedNetworkHeaders(t){return[...eI,...t.map(t=>t.toLowerCase())]}Replay.__initStatic()}}]);